# TPM Plugin Manager Path
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

# ==============================================================================
# Performance & Core Settings
# ==============================================================================
set-option -s escape-time 0
set-option -g history-limit 50000
set-option -g display-time 4000
set-option -g focus-events on

# True color support (modern terminals)
set-option -g default-terminal "tmux-256color"
set-option -sa terminal-features ',*256col*:RGB'
set-option -ga terminal-overrides ',*256col*:Tc'

# ==============================================================================
# Plugins (minimal, performance-focused)
# ==============================================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'catppuccin/tmux#v2.1.3'

# Continuum settings
set -g @continuum-restore 'on'

# ==============================================================================
# Catppuccin Theme Configuration (fast, native implementation)
# ==============================================================================
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_status_background "none"

# Window styling
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W"
set -g @catppuccin_window_flags "icon"
set -g @catppuccin_window_flags_icon_current " 󰖯"
set -g @catppuccin_window_flags_icon_last " 󰖰"

# Status bar modules
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_right_separator "█"
set -g @catppuccin_status_connect_separator "no"

# Status bar configuration
set -g status-left ""
set -g status-right "#{catppuccin_session}"

# ==============================================================================
# Mouse & Input
# ==============================================================================
set-option -g mouse on
set-option -g set-clipboard on

# Scroll speed (native, no plugin needed)
bind -T copy-mode-vi WheelUpPane select-pane \; send-keys -X -N 3 scroll-up
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 3 scroll-down

# ==============================================================================
# Shell & Visual
# ==============================================================================
set-option -g default-shell /bin/zsh
set-window-option -g visual-bell on
set-window-option -g bell-action other

# Status bar position and refresh
set-option -g status on
set-option -g status-interval 5
set-option -g status-position bottom
set-option -g status-justify centre

# ==============================================================================
# Copy Mode (cross-platform clipboard integration)
# ==============================================================================
setw -g mode-keys vi

# macOS
if-shell "uname | grep -q Darwin" {
  bind-key -T copy-mode-vi v send-keys -X begin-selection
  bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
  bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
}

# Linux (auto-detect Wayland/X11)
if-shell "uname | grep -q Linux" {
  set -g @copy_cmd 'if [ -n "$WAYLAND_DISPLAY" ] && command -v wl-copy >/dev/null; then wl-copy; else xclip -selection clipboard; fi'
  bind-key -T copy-mode-vi v send-keys -X begin-selection
  bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"
  bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"
}

# ==============================================================================
# Key Bindings
# ==============================================================================
bind C-p previous-window
bind C-n next-window
bind R source-file '~/.tmux.conf' \; display-message "Config reloaded"

# Split panes with | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Vim-style pane navigation (repeatable)
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Resize panes with Ctrl + hjkl
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5

# ==============================================================================
# Initialize TMUX plugin manager (keep this line at the very bottom)
# ==============================================================================
run -b '~/.tmux/plugins/tpm/tpm'
