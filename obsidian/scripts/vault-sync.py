IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKT2JzaWRpYW4gVmF1bHQgU3luYyAtIO2Gte2VqSDsiqTtgazrpr3tirgKCkNsYXVkZSDshLjshZgg64+Z6riw7ZmULCDsoJXrpqwsIO2DnOq3uCDstpTqsIAsIElOREVYIOyDneyEseydhCDtlZjrgpjsnZgg7Iqk7YGs66a97Yq466GcIOyymOumrO2VqeuLiOuLpC4KCuyCrOyaqeuylToKICAgICMg7KCE7LK0IOuPmeq4sO2ZlCAoc3luYyArIGNsZWFudXAgKyB0YWdzICsgaW5kZXgpCiAgICBweXRob24gdmF1bHQtc3luYy5weQoKICAgICMg6rCc67OEIOuqheuguQogICAgcHl0aG9uIHZhdWx0LXN5bmMucHkgc3luYyAgICAgICAgICAgICAgIyDshLjshZgg64+Z6riw7ZmU66eMCiAgICBweXRob24gdmF1bHQtc3luYy5weSBjbGVhbnVwICAgICAgICAgICAjIOyEuOyFmCDsoJXrpqzrp4wKICAgIHB5dGhvbiB2YXVsdC1zeW5jLnB5IHRhZ3MgICAgICAgICAgICAgICMg7YOc6re4IOy2lOqwgOunjAogICAgcHl0aG9uIHZhdWx0LXN5bmMucHkgaW5kZXggICAgICAgICAgICAgIyBJTkRFWCDsg53shLHrp4wKCiAgICAjIOyYteyFmAogICAgcHl0aG9uIHZhdWx0LXN5bmMucHkgLS1kcnktcnVuICAgICAgICAgIyDrr7jrpqzrs7TquLAKICAgIHB5dGhvbiB2YXVsdC1zeW5jLnB5IC0tZm9yY2UgICAgICAgICAgICMg6riw7KG0IO2MjOydvCDrja7slrTsk7DquLAKICAgIHB5dGhvbiB2YXVsdC1zeW5jLnB5IC0tdmVyYm9zZSAgICAgICAgICMg7IOB7IS4IOy2nOugpQogICAgcHl0aG9uIHZhdWx0LXN5bmMucHkgLS1wcm9qZWN0IHNzdWRhbSAgIyDtirnsoJUg7ZSE66Gc7KCd7Yq466eMCiIiIgoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBoYXNobGliCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcmUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHN5cwppbXBvcnQgdGltZQppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB1cmxsaWIucmVxdWVzdAppbXBvcnQgdXJsbGliLmVycm9yCmltcG9ydCBiYXNlNjQKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwaW5nIGltcG9ydCBPcHRpb25hbAoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgQ29uZmlndXJhdGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KClZBVUxUX1JPT1QgPSBQYXRoLmhvbWUoKSAvICJzLWxhc3RvcmRlciIKV09SS1NQQUNFX0RJUiA9IFZBVUxUX1JPT1QgLyAid29ya3NwYWNlIgpXT1JLU1BBQ0VfVklCRV9ESVIgPSBWQVVMVF9ST09UIC8gIndvcmtzcGFjZS12aWJlIgpXT1JLU1BBQ0VfRVhUX0RJUiA9IFZBVUxUX1JPT1QgLyAid29ya3NwYWNlLWV4dCIKCiMgQ291Y2hEQiAoU2VsZi1ob3N0ZWQgTGl2ZVN5bmMpIOyEpOyglQpDT1VDSERCX1VSSSA9ICJodHRwczovL29ic2lkaWFuLmppdW4uZGV2IgpDT1VDSERCX1VTRVIgPSAiYWRtaW4iCkNPVUNIREJfUEFTU1dPUkQgPSAiSml1bjU0ODZAIyIKQ09VQ0hEQl9EQk5BTUUgPSAib2JzaWRpYW4iCkNIVU5LX1NJWkUgPSAyNTAgICMgTGl2ZVN5bmMg6riw67O4IOyyre2BrCDtgazquLAKCiMg66Gc7LusIHdvcmtzcGFjZSDqsr3roZzrk6QKTE9DQUxfV09SS1NQQUNFUyA9IFsKICAgIChQYXRoLmhvbWUoKSAvICJ3b3Jrc3BhY2UtdmliZSIsIFdPUktTUEFDRV9WSUJFX0RJUiksCiAgICAoUGF0aC5ob21lKCkgLyAid29ya3NwYWNlLWV4dCIsIFdPUktTUEFDRV9FWFRfRElSKSwKICAgIChQYXRoLmhvbWUoKSAvICJ3b3Jrc3BhY2UiLCBXT1JLU1BBQ0VfRElSKSwKXQoKTUFDSElORVMgPSB7CiAgICAibG9jYWwiOiB7InR5cGUiOiAibG9jYWwifSwKICAgICJqaXVuLW1icCI6IHsidHlwZSI6ICJzc2giLCAiaG9zdCI6ICJqaXVuLW1icCJ9LAogICAgImp1bmUtbWJwIjogeyJ0eXBlIjogInNzaCIsICJob3N0IjogImp1bmUtbWJwIn0sCn0KCiMg7IS47IWYIOygnOuqqSDsiqTtgrUg7Yyo7YS0ClNLSVBfVElUTEVfUEFUVEVSTlMgPSBbCiAgICByIl5XYXJtdXAkIiwKICAgIHIiXlVudGl0bGVkIFNlc3Npb24kIiwKICAgIHIiXmFnZW50LVthLWYwLTldKyQiLApdCgojIOusuOyEnCDsnKDtmJUg6rCQ7KeAIO2MqO2EtApUWVBFX1BBVFRFUk5TID0gWwogICAgKHIiQk1bLV9dPyjrtoTshJ18QW5hbHlzaXMpfOu5hOymiOuLiOyKpFstX10/66qo6424fGJ1c2luZXNzWy1fXT9tb2RlbCIsICJibS1hbmFseXNpcyIpLAogICAgKHIi6riw7ZqN7IScfOq4sO2ajeyViHxwbGFubmluZ3xwbGFuJCIsICJwbGFubmluZyIpLAogICAgKHIi7KCE6561Lirrs7Tqs6DshJx8c3RyYXRlZ3kuKnJlcG9ydCIsICJzdHJhdGVneSIpLAogICAgKHIi7JWE7YKk7YWN7LKYfGFyY2hpdGVjdHVyZSIsICJhcmNoaXRlY3R1cmUiKSwKICAgIChyIuu2hOyEnS4q67O06rOg7IScfGFuYWx5c2lzLipyZXBvcnQiLCAiYW5hbHlzaXMiKSwKICAgIChyIuqwnOyEoFstX10/6riw7ZqNfGltcHJvdmVtZW50IiwgImltcHJvdmVtZW50IiksCiAgICAociLrpqzrt7B8cmV2aWV3fGZlZWRiYWNrIiwgInJldmlldyIpLAogICAgKHIiUkVBRE1FfOusuOyEnO2ZlHxkb2N1bWVudGF0aW9uIiwgImRvY3VtZW50YXRpb24iKSwKICAgIChyIkNPREVYfOq1rO2YhHxpbXBsZW1lbnRhdGlvbiIsICJpbXBsZW1lbnRhdGlvbiIpLApdCgojIO2GoO2UvSDtg5zqt7gg7Yyo7YS0ClRPUElDX1RBR1MgPSBbCiAgICAjIFRlY2ggc3RhY2sKICAgIChyIlxicnVzdFxiIiwgInJ1c3QiKSwKICAgIChyIlxidHlwZXNjcmlwdFxifFxidHNcYiIsICJ0eXBlc2NyaXB0IiksCiAgICAociJcYnB5dGhvblxiIiwgInB5dGhvbiIpLAogICAgKHIiXGJzd2lmdFxifFxiaW9zXGJ8XGJzd2lmdHVpXGIiLCAiaW9zIiksCiAgICAociJcYmFuZHJvaWRcYnxcYmtvdGxpblxiIiwgImFuZHJvaWQiKSwKICAgIChyIlxicmVhY3RcYnxcYm5leHRqc1xifFxibmV4dFwuanNcYiIsICJyZWFjdCIpLAogICAgKHIiXGJub2RlXC4/anNcYnxcYmV4cHJlc3NcYnxcYm5lc3Rqc1xiIiwgIm5vZGVqcyIpLAogICAgKHIiXGJkb2NrZXJcYnxcYmNvbnRhaW5lclxiIiwgImRvY2tlciIpLAogICAgKHIiXGJrdWJlcm5ldGVzXGJ8XGJrOHNcYiIsICJrdWJlcm5ldGVzIiksCiAgICAociJcYnRlcnJhZm9ybVxifFxiaWFjXGIiLCAidGVycmFmb3JtIiksCiAgICAjIERvbWFpbgogICAgKHIiXGJhaVxifFxi7J246rO17KeA64qlXGJ8XGJsbG1cYnxcYmdwdFxifFxiY2xhdWRlXGIiLCAiYWkiKSwKICAgIChyIlxi7J2M7ISxXGJ8XGJ2b2ljZVxifFxic3BlZWNoXGIiLCAidm9pY2UiKSwKICAgIChyIlxibWxcYnxcYm1hY2hpbmVbLV9dP2xlYXJuaW5nXGIiLCAibWwiKSwKICAgICMgQnVzaW5lc3MKICAgIChyIlxic2Fhc1xiIiwgInNhYXMiKSwKICAgIChyIlxiYjJiXGIiLCAiYjJiIiksCiAgICAociJcYmIyY1xiIiwgImIyYyIpLAogICAgKHIiXGLqtazrj4VcYnxcYnN1YnNjcmlwdGlvblxiIiwgInN1YnNjcmlwdGlvbiIpLAogICAgIyBBcmNoaXRlY3R1cmUKICAgIChyIlxiYmFja2VuZFxifFxi67Cx7JeU65OcXGJ8XGJzZXJ2ZXJcYnxcYmFwaVxiIiwgImJhY2tlbmQiKSwKICAgIChyIlxiZnJvbnRlbmRcYnxcYu2UhOuhoO2KuOyXlOuTnFxifFxidWlcYnxcYnV4XGIiLCAiZnJvbnRlbmQiKSwKICAgIChyIlxibW9iaWxlXGJ8XGLrqqjrsJTsnbxcYiIsICJtb2JpbGUiKSwKICAgIChyIlxiaW5mcmFcYnxcYmluZnJhc3RydWN0dXJlXGIiLCAiaW5mcmFzdHJ1Y3R1cmUiKSwKICAgIChyIlxiZGV2b3BzXGJ8XGJjaVstX10/Y2RcYiIsICJkZXZvcHMiKSwKXQoKIyDsg4Htg5wg6rCQ7KeAIO2MqO2EtApTVEFUVVNfUEFUVEVSTlMgPSBbCiAgICAociLsmYTro4x8Y29tcGxldGV8ZG9uZXxmaW5pc2hlZCIsICJjb21wbGV0ZWQiKSwKICAgIChyIuynhO2WieykkXxpblstX10/cHJvZ3Jlc3N8d2lwfG9uZ29pbmciLCAiaW4tcHJvZ3Jlc3MiKSwKICAgIChyIuy0iOyViHxkcmFmdCIsICJkcmFmdCIpLAogICAgKHIi67O066WYfGFyY2hpdmVkfGRlcHJlY2F0ZWQiLCAiYXJjaGl2ZWQiKSwKXQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFV0aWxpdGllcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBydW5fc3NoKGhvc3Q6IHN0ciwgY29tbWFuZDogc3RyKSAtPiB0dXBsZVtpbnQsIHN0ciwgc3RyXToKICAgICIiIlNTSCDrqoXroLkg7Iuk7ZaJIiIiCiAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICBbInNzaCIsIGhvc3QsIGNvbW1hbmRdLAogICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsCiAgICAgICAgdGV4dD1UcnVlLAogICAgICAgIHRpbWVvdXQ9NjAKICAgICkKICAgIHJldHVybiByZXN1bHQucmV0dXJuY29kZSwgcmVzdWx0LnN0ZG91dCwgcmVzdWx0LnN0ZGVycgoKCmRlZiBwYXJzZV9qc29ubChjb250ZW50OiBzdHIpIC0+IGxpc3RbZGljdF06CiAgICAiIiJKU09OTCDtjIzsi7EiIiIKICAgIG1lc3NhZ2VzID0gW10KICAgIGZvciBsaW5lIGluIGNvbnRlbnQuc3BsaXQoIlxuIik6CiAgICAgICAgaWYgbGluZS5zdHJpcCgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtZXNzYWdlcy5hcHBlbmQoanNvbi5sb2FkcyhsaW5lKSkKICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgIHJldHVybiBtZXNzYWdlcwoKCmRlZiBmb3JtYXRfdGltZXN0YW1wKHRzX3N0cjogc3RyKSAtPiBzdHI6CiAgICAiIiLtg4DsnoTsiqTtg6ztlIQg7Y+s66e3IiIiCiAgICBpZiBub3QgdHNfc3RyOgogICAgICAgIHJldHVybiAiIgogICAgdHJ5OgogICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdCh0c19zdHIucmVwbGFjZSgiWiIsICIrMDA6MDAiKSkKICAgICAgICByZXR1cm4gZHQuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNOiVTIikKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gdHNfc3RyCgoKZGVmIGV4dHJhY3RfcHJvamVjdF9pbmZvKGRpcl9uYW1lOiBzdHIsIG1hY2hpbmVfdHlwZTogc3RyID0gImxvY2FsIikgLT4gT3B0aW9uYWxbdHVwbGVbc3RyLCBQYXRoXV06CiAgICAiIiJDbGF1ZGUgcHJvamVjdHMg65SU66CJ7Yag66as66qF7JeQ7IScIO2UhOuhnOygne2KuOuqheqzvCDrjIDsg4Eg65SU66CJ7Yag66asIOy2lOy2nAoKICAgIOykkeyyqSDrlJTroInthqDrpqwg6rWs7KGw7JeQ7ISc64qUIHdvcmtzcGFjZSDrsJTroZwg64uk7J2MIOuUlOugie2GoOumrOunjCDsgqzsmqk=LgogICAgd29ya3NwYWNlIOujqO2KuOyXkOyEnCDsnpHsl4XtlZwg7IS47IWY7J2AIE5vbmUg67CY7ZmYICjsiqTtgrUpLgoKICAgIFJldHVybnM6CiAgICAgICAgKO2UhOuhnOygne2KuOuqhSwgdmF1bHRfdGFyZ2V0X2Rpcikg7Yqc7ZSMIOuYkOuKlCBOb25lICjsiqTtgrXtlbTslbwg7ZWY64qUIOqyveyasCkKICAgICIiIgogICAgIyB3b3Jrc3BhY2UtdmliZSBwcmVmaXggKHdvcmtzcGFjZeuztOuLpCDrqLzsoIAg7LK07YGs7ZW07JW8IO2VqCkKICAgIHdvcmtzcGFjZV92aWJlX3ByZWZpeGVzID0gWwogICAgICAgICItVXNlcnMtanVuZS13b3Jrc3BhY2UtdmliZS0iLAogICAgICAgICItVXNlcnMtaml1bi13b3Jrc3BhY2UtdmliZS0iLAogICAgXQogICAgIyB3b3Jrc3BhY2UtZXh0IHByZWZpeCAod29ya3NwYWNl67O064ukIOuovOyggCDssrTtgaztlbTslbwg7ZWoKQogICAgd29ya3NwYWNlX2V4dF9wcmVmaXhlcyA9IFsKICAgICAgICAiLVVzZXJzLWp1bmUtd29ya3NwYWNlLWV4dC0iLAogICAgICAgICItVXNlcnMtaml1bi13b3Jrc3BhY2UtZXh0LSIsCiAgICBdCiAgICAjIHdvcmtzcGFjZSBwcmVmaXgKICAgIHdvcmtzcGFjZV9wcmVmaXhlcyA9IFsKICAgICAgICAiLVVzZXJzLWp1bmUtd29ya3NwYWNlLSIsCiAgICAgICAgIi1Vc2Vycy1qaXVuLXdvcmtzcGFjZS0iLAogICAgXQogICAgaG9tZV9wcmVmaXhlcyA9IFsKICAgICAgICAiLVVzZXJzLWp1bmUtIiwKICAgICAgICAiLVVzZXJzLWppdW4tIiwKICAgIF0KCiAgICAjIHdvcmtzcGFjZS12aWJlIHByZWZpeCDsspjrpqwKICAgIGZvciBwcmVmaXggaW4gd29ya3NwYWNlX3ZpYmVfcHJlZml4ZXM6CiAgICAgICAgaWYgZGlyX25hbWUuc3RhcnRzd2l0aChwcmVmaXgpOgogICAgICAgICAgICByZW1haW5pbmcgPSBkaXJfbmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpCiAgICAgICAgICAgIGlmIG5vdCByZW1haW5pbmc6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgIyDroZzsu6wg66i47IugOiDsi6TsoJwg65SU66CJ7Yag66as7JmAIOunpOy5rQogICAgICAgICAgICBpZiBtYWNoaW5lX3R5cGUgPT0gImxvY2FsIjoKICAgICAgICAgICAgICAgIHdvcmtzcGFjZV9kaXIgPSBQYXRoLmhvbWUoKSAvICJ3b3Jrc3BhY2UtdmliZSIKICAgICAgICAgICAgICAgIGlmIHdvcmtzcGFjZV9kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIHByb2plY3RfZGlyIGluIHdvcmtzcGFjZV9kaXIuaXRlcmRpcigpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwcm9qZWN0X2Rpci5pc19kaXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RfbmFtZSA9IHByb2plY3RfZGlyLm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlbWFpbmluZyA9PSBwcm9qZWN0X25hbWUgb3IgcmVtYWluaW5nLnN0YXJ0c3dpdGgocHJvamVjdF9uYW1lICsgIi0iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHByb2plY3RfbmFtZSwgV09SS1NQQUNFX1ZJQkVfRElSKQoKICAgICAgICAgICAgIyB2YXVsdOyXkCDsnbTrr7gg7KG07J6s7ZWY64qUIO2UhOuhnOygne2KuOyZgCDrp6Tsua0KICAgICAgICAgICAgaWYgV09SS1NQQUNFX1ZJQkVfRElSLmV4aXN0cygpOgogICAgICAgICAgICAgIA==ICBmb3IgdmF1bHRfcHJvamVjdCBpbiBXT1JLU1BBQ0VfVklCRV9ESVIuaXRlcmRpcigpOgogICAgICAgICAgICAgICAgICAgIGlmIHZhdWx0X3Byb2plY3QuaXNfZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZwX25hbWUgPSB2YXVsdF9wcm9qZWN0Lm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVtYWluaW5nID09IHZwX25hbWUgb3IgcmVtYWluaW5nLnN0YXJ0c3dpdGgodnBfbmFtZSArICItIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZwX25hbWUsIFdPUktTUEFDRV9WSUJFX0RJUikKCiAgICAgICAgICAgIHJldHVybiAocmVtYWluaW5nLCBXT1JLU1BBQ0VfVklCRV9ESVIpCgogICAgIyB3b3Jrc3BhY2UtdmliZSDro6jtirgg7Iqk7YK1CiAgICBmb3IgcHJlZml4IGluIFsiLVVzZXJzLWp1bmUtd29ya3NwYWNlLXZpYmUiLCAiLVVzZXJzLWppdW4td29ya3NwYWNlLXZpYmUiXToKICAgICAgICBpZiBkaXJfbmFtZSA9PSBwcmVmaXg6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgIyB3b3Jrc3BhY2UtZXh0IHByZWZpeCDsspjrpqwKICAgIGZvciBwcmVmaXggaW4gd29ya3NwYWNlX2V4dF9wcmVmaXhlczoKICAgICAgICBpZiBkaXJfbmFtZS5zdGFydHN3aXRoKHByZWZpeCk6CiAgICAgICAgICAgIHJlbWFpbmluZyA9IGRpcl9uYW1lLnJlcGxhY2UocHJlZml4LCAiIikKICAgICAgICAgICAgaWYgbm90IHJlbWFpbmluZzoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAjIOuhnOy7rCDrqLjsi6A6IOyLpOygnCDrlJTroInthqDrpqzsmYAg66ek7LmtCiAgICAgICAgICAgIGlmIG1hY2hpbmVfdHlwZSA9PSAibG9jYWwiOgogICAgICAgICAgICAgICAgd29ya3NwYWNlX2RpciA9IFBhdGguaG9tZSgpIC8gIndvcmtzcGFjZS1leHQiCiAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2VfZGlyLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgIGZvciBwcm9qZWN0X2RpciBpbiB3b3Jrc3BhY2VfZGlyLml0ZXJkaXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHJvamVjdF9kaXIuaXNfZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0X25hbWUgPSBwcm9qZWN0X2Rpci5uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZW1haW5pbmcgPT0gcHJvamVjdF9uYW1lIG9yIHJlbWFpbmluZy5zdGFydHN3aXRoKHByb2plY3RfbmFtZSArICItIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChwcm9qZWN0X25hbWUsIFdPUktTUEFDRV9FWFRfRElSKQoKICAgICAgICAgICAgIyB2YXVsdOyXkCDsnbTrr7gg7KG07J6s7ZWY64qUIO2UhOuhnOygne2KuOyZgCDrp6Tsua0KICAgICAgICAgICAgaWYgV09SS1NQQUNFX0VYVF9ESVIuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBmb3IgdmF1bHRfcHJvamVjdCBpbiBXT1JLU1BBQ0VfRVhUX0RJUi5pdGVyZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgaWYgdmF1bHRfcHJvamVjdC5pc19kaXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgdnBfbmFtZSA9IHZhdWx0X3Byb2plY3QubmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiByZW1haW5pbmcgPT0gdnBfbmFtZSBvciByZW1haW5pbmcuc3RhcnRzd2l0aCh2cF9uYW1lICsgIi0iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodnBfbmFtZSwgV09SS1NQQUNFX0VYVF9ESVIpCgogICAgICAgICAgICByZXR1cm4gKHJlbWFpbmluZywgV09SS1NQQUNFX0VYVF9ESVIpCgogICAgIyB3b3Jrc3BhY2UtZXh0IOujqO2KuCDsiqTtgrUKICAgIGZvciBwcmVmaXggaW4gWyItVXNlcnMtanVuZS13b3Jrc3BhY2UtZXh0IiwgIi1Vc2Vycy1qaXVuLXdvcmtzcGFjZS1leHQiXToKICAgICAgICBpZiBkaXJfbmFtZSA9PSBwcmVmaXg6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgIyB3b3Jrc3BhY2UgcHJlZml4IOyymOumrAogICAgZm9yIHByZWZpeCBpbiB3b3Jrc3BhY2VfcHJlZml4ZXM6CiAgICAgICAgaWYgZGlyX25hbWUuc3RhcnRzd2l0aChwcmVmaXgpOgogICAgICAgICAgICByZW1haW5pbmcgPSBkaXJfbmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpCgogICAgICAgICAgICAjIHdvcmtzcGFjZSDro6jtirjsl5DshJwg7J6R7JeF7ZWcIOyEuOyFmOydgCDsiqTtgrUKICAgICAgICAgICAgaWYgbm90IHJlbWFpbmluZzoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAjIOuhnOy7rCDrqLjsi6A6IOyLpOygnCB3b3Jrc3BhY2Ug65SU66CJ7Yag66as7JmAIOunpOy5rQogICAgICAgICAgICBpZiBtYWNoaW5lX3R5cGUgPT0gImxvY2FsIjoKICAgICAgICAgICAgICAgIHdvcmtzcGFjZV9kaXIgPSBQYXRoLmhvbWUoKSAvICJ3b3Jrc3BhY2UiCiAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2VfZGlyLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgIGZvciBwcm9qZWN0X2RpciBpbiB3b3Jrc3BhY2VfZGlyLml0ZXJkaXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHJvamVjdF9kaXIuaXNfZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0X25hbWUgPSBwcm9qZWN0X2Rpci5uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZW1haW5pbmcgPT0gcHJvamVjdF9uYW1lIG9yIHJlbWFpbmluZy5zdGFydHN3aXRoKHByb2plY3RfbmFtZSArICItIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChwcm9qZWN0X25hbWUsIFdPUktTUEFDRV9ESVIpCgogICAgICAgICAgICAjIHZhdWx07JeQIOydtOuvuCDsobTsnqztlZjripQg7ZSE66Gc7KCd7Yq47JmAIOunpOy5rQogICAgICAgICAgICBpZiBXT1JLU1BBQ0VfRElSLmV4aXN0cygpOgogICAgICAgICAgICAgICAgZm9yIHZhdWx0X3Byb2plY3QgaW4gV09SS1NQQUNFX0RJUi5pdGVyZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgaWYgdmF1bHRfcHJvamVjdC5pc19kaXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgdnBfbmFtZSA9IHZhdWx0X3Byb2plY3QubmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiByZW1haW5pbmcgPT0gdnBfbmFtZSBvciByZW1haW5pbmcuc3RhcnRzd2l0aCh2cF9uYW1lICsgIi0iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodnBfbmFtZSwgV09SS1NQQUNFX0RJUikKCiAgICAgICAgICAgICMg66ek7LmtIOyLpO2MqDogcmVtYWluaW5nIOyghOyytCDrsJjtmZggKOyDiCDtlITroZzsoJ3tirjroZwg7IOd7ISx65CoKQogICAgICAgICAgICByZXR1cm4gKHJlbWFpbmluZywgV09SS1NQQUNFX0RJUikKCiAgICAjIOydvOuwmCB3b3Jrc3BhY2UgcHJlZml4IOyymOumrCAo7JiIOiAtVXNlcnMtaml1bi13b3Jrc3BhY2UpCiAgICBmb3IgcHJlZml4IGluIFsiLVVzZXJzLWp1bmUtd29ya3NwYWNlIiwgIi1Vc2Vycy1qaXVuLXdvcmtzcGFjZSJdOgogICAgICAgIGlmIGRpcl9uYW1lID09IHByZWZpeDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUgICMgd29ya3NwYWNlIOujqO2KuOuKlCDsiqTtgrUKCiAgICAjIGhvbWUgcHJlZml4IOyymOumrAogICAgZm9yIHByZWZpeCBpbiBob21lX3ByZWZpeGVzOgogICAgICAgIGlmIGRpcl9uYW1lLnN0YXJ0c3dpdGgocHJlZml4KToKICAgICAgICAgICAgcmVtYWluaW5nID0gZGlyX25hbWUucmVwbGFjZShwcmVmaXgsICIiKQogICAgICAgICAgICBpZiBub3QgcmVtYWluaW5nIG9yIHJlbWFpbmluZyBpbiBbIndvcmtzcGFjZSIsICJ3b3Jrc3BhY2UtdmliZSIsICJ3b3Jrc3BhY2UtZXh0Il06CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAjIHdvcmtzcGFjZS12aWJlIO2VmOychOyduOyngCDtmZXsnbgKICAgICAgICAgICAgaWYgcmVtYWluaW5nLnN0YXJ0c3dpdGgoIndvcmtzcGFjZS12aWJlLSIpOgogICAgICAgICAgICAgICAgcHJvaiA9IHJlbWFpbmluZy5yZXBsYWNlKCJ3b3Jrc3BhY2UtdmliZS0iLCAiIikKICAgICAgICAgICAgICAgIHJldHVybiAocHJvaiwgV09SS1NQQUNFX1ZJQkVfRElSKSBpZiBwcm9qIGVsc2UgTm9uZQogICAgICAgICAgICAjIHdvcmtzcGFjZS1leHQg7ZWY7JyE7J247KeAIO2ZleyduAogICAgICAgICAgICBpZiByZW1haW5pbmcuc3RhcnRzd2l0aCgid29ya3NwYWNlLWV4dC0iKToKICAgICAgICAgICAgICAgIHByb2ogPSByZW1haW5pbmcucmVwbGFjZSgid29ya3NwYWNlLWV4dC0iLCAiIikKICAgICAgICAgICAgICAgIHJldHVybiAocHJvaiwgV09SS1NQQUNFX0VYVF9ESVIpIGlmIHByb2ogZWxzZSBOb25lCiAgICAgICAgICAgIHJldHVybiAocmVtYWluaW5nLCBXT1JLU1BBQ0VfRElSKQoKICAgIHBhcnRzID0gZGlyX25hbWUuc3BsaXQoIi0iKQogICAgcHJvaiA9IHBhcnRzWy0xXSBpZiBwYXJ0cyBlbHNlIGRpcl9uYW1lCiAgICByZXR1cm4gKHByb2osIFdPUktTUEFDRV9ESVIpIGlmIHByb2ogZWxzZSBOb25lCgoKZGVmIHNob3VsZF9za2lwX3RpdGxlKHRpdGxlOiBzdHIpIC0+IGJvb2w6CiAgICAiIiLshLjshZgg7KCc66qpIOyKpO2CtSDsl6zrtoAiIiIKICAgIGZvciBwYXR0ZXJuIGluIFNLSVBfVElUTEVfUEFUVEVSTlM6CiAgICAgICAgaWYgcmUubWF0Y2gocGF0dGVybiwgdGl0bGUsIHJlLklHTk9SRUNBU0UpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGdldF9tZXNzYWdlX2NvbnRlbnQobXNnOiBkaWN0KSAtPiBzdHI6CiAgICAiIiLrqZTsi5zsp4Dsl5DshJwg7YWN7Iqk7Yq4IOy2lOy2nCIiIgogICAgbXNnX3R5cGUgPSBtc2cuZ2V0KCJ0eXBlIikKCiAgICBpZiBtc2dfdHlwZSA9PSAidXNlciI6CiAgICAgICAgbWVzc2FnZSA9IG1zZy5nZXQoIm1lc3NhZ2UiLCB7fSkKICAgICAgICBpZiBpc2luc3RhbmNlKG1lc3NhZ2UsIGRpY3QpOgogICAgICAgICAgICBjb250ZW50ID0gbWVzc2FnZS5nZXQoImNvbnRlbnQiLCAiIikKICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQgaWYgaXNpbnN0YW5jZShjb250ZW50LCBzdHIpIGVsc2UgIiIKICAgICAgICByZXR1cm4gc3RyKG1zZy5nZXQoImNvbnRlbnQiLCAiIikpCgogICAgaWYgbXNnX3R5cGUgPT0gImFzc2lzdGFudCI6CiAgICAgICAgbWVzc2FnZSA9IG1zZy5nZXQoIm1lc3NhZ2UiLCB7fSkKICAgICAgICBpZiBpc2luc3RhbmNlKG1lc3NhZ2UsIGRpY3QpOgogICAgICAgICAgICBjb250ZW50X2xpc3QgPSBtZXNzYWdlLmdldCgiY29udGVudCIsIFtdKQogICAgICAgIA==ICAgIGlmIGlzaW5zdGFuY2UoY29udGVudF9saXN0LCBsaXN0KToKICAgICAgICAgICAgICAgIHRleHRfcGFydHMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gY29udGVudF9saXN0OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaXRlbSwgZGljdCkgYW5kIGl0ZW0uZ2V0KCJ0eXBlIikgPT0gInRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0X3BhcnRzLmFwcGVuZChpdGVtLmdldCgidGV4dCIsICIiKSkKICAgICAgICAgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UoaXRlbSwgc3RyKToKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dF9wYXJ0cy5hcHBlbmQoaXRlbSkKICAgICAgICAgICAgICAgIHJldHVybiAiXG4iLmpvaW4odGV4dF9wYXJ0cykKICAgICAgICByZXR1cm4gc3RyKG1zZy5nZXQoImNvbnRlbnQiLCAiIikpCgogICAgcmV0dXJuICIiCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgU3luYyBDb21tYW5kCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGNvbnZlcnRfc2Vzc2lvbl90b19tYXJrZG93bigKICAgIHNlc3Npb25faWQ6IHN0ciwKICAgIG1lc3NhZ2VzOiBsaXN0W2RpY3RdLAogICAgcHJvamVjdF9uYW1lOiBzdHIsCiAgICBtYWNoaW5lX25hbWU6IHN0cgopIC0+IE9wdGlvbmFsW3N0cl06CiAgICAiIiLshLjshZjsnYQg66eI7YGs64uk7Jq07Jy866GcIOuzgO2ZmCIiIgogICAgaWYgbm90IG1lc3NhZ2VzOgogICAgICAgIHJldHVybiBOb25lCgogICAgIyDssqsg66mU7Iuc7KeA7JeQ7IScIO2DgOyehOyKpO2DrO2UhAogICAgZmlyc3RfbXNnID0gTm9uZQogICAgZm9yIG1zZyBpbiBtZXNzYWdlczoKICAgICAgICBpZiBtc2cuZ2V0KCJ0eXBlIikgaW4gWyJ1c2VyIiwgImFzc2lzdGFudCJdOgogICAgICAgICAgICBmaXJzdF9tc2cgPSBtc2cKICAgICAgICAgICAgYnJlYWsKICAgIGlmIG5vdCBmaXJzdF9tc2c6CiAgICAgICAgZmlyc3RfbXNnID0gbWVzc2FnZXNbMF0gaWYgbWVzc2FnZXMgZWxzZSB7fQoKICAgIGNyZWF0ZWRfYXQgPSBmb3JtYXRfdGltZXN0YW1wKGZpcnN0X21zZy5nZXQoInRpbWVzdGFtcCIsICIiKSkKCiAgICAjIOygnOuqqSDstpTstpwKICAgIHRpdGxlID0gIlVudGl0bGVkIFNlc3Npb24iCiAgICBmb3IgbXNnIGluIG1lc3NhZ2VzOgogICAgICAgIGNvbnRlbnQgPSBnZXRfbWVzc2FnZV9jb250ZW50KG1zZykKICAgICAgICBpZiBjb250ZW50LnN0cmlwKCk6CiAgICAgICAgICAgIHRpdGxlID0gKGNvbnRlbnRbOjEwMF0gKyAiLi4uIikgaWYgbGVuKGNvbnRlbnQpID4gMTAwIGVsc2UgY29udGVudAogICAgICAgICAgICB0aXRsZSA9IHRpdGxlLnJlcGxhY2UoIlxuIiwgIiAiKS5zdHJpcCgpCiAgICAgICAgICAgIGJyZWFrCgogICAgIyDsiqTtgrUg7LK07YGsCiAgICBpZiBzaG91bGRfc2tpcF90aXRsZSh0aXRsZSk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIOy1nOyGjCDrgrTsmqkg7LK07YGsCiAgICBjb250ZW50X2NvdW50ID0gc3VtKDEgZm9yIG1zZyBpbiBtZXNzYWdlcyBpZiBnZXRfbWVzc2FnZV9jb250ZW50KG1zZykuc3RyaXAoKSkKICAgIGlmIGNvbnRlbnRfY291bnQgPCAyOgogICAgICAgIHJldHVybiBOb25lCgogICAgIyDrp4jtgazri6TsmrQg7IOd7ISxCiAgICBzYWZlX3RpdGxlID0gdGl0bGUucmVwbGFjZSgnIicsICdcXCInKQogICAgbWQgPSBbCiAgICAgICAgIi0tLSIsCiAgICAgICAgZiJzZXNzaW9uSWQ6IHtzZXNzaW9uX2lkfSIsCiAgICAgICAgZiJwcm9qZWN0OiB7cHJvamVjdF9uYW1lfSIsCiAgICAgICAgZiJtYWNoaW5lOiB7bWFjaGluZV9uYW1lfSIsCiAgICAgICAgZiJjcmVhdGVkOiB7Y3JlYXRlZF9hdH0iLAogICAgICAgIGYndGl0bGU6ICJ7c2FmZV90aXRsZX0iJywKICAgICAgICAidGFnczogW2NsYXVkZS1zZXNzaW9uLCB3b3Jrc3BhY2VdIiwKICAgICAgICAiLS0tXG4iLAogICAgICAgIGYiIyB7dGl0bGV9XG4iLAogICAgXQoKICAgIGZvciBtc2cgaW4gbWVzc2FnZXM6CiAgICAgICAgbXNnX3R5cGUgPSBtc2cuZ2V0KCJ0eXBlIikKICAgICAgICB0aW1lc3RhbXAgPSBmb3JtYXRfdGltZXN0YW1wKG1zZy5nZXQoInRpbWVzdGFtcCIsICIiKSkKICAgICAgICBjb250ZW50ID0gZ2V0X21lc3NhZ2VfY29udGVudChtc2cpCgogICAgICAgIGlmIG1zZ190eXBlID09ICJ1c2VyIiBhbmQgY29udGVudC5zdHJpcCgpOgogICAgICAgICAgICBtZC5hcHBlbmQoZiIjIyBVc2VyICh7dGltZXN0YW1wfSlcbiIpCiAgICAgICAgICAgIG1kLmFwcGVuZChmIntjb250ZW50fVxuIikKICAgICAgICBlbGlmIG1zZ190eXBlID09ICJhc3Npc3RhbnQiIGFuZCBjb250ZW50LnN0cmlwKCk6CiAgICAgICAgICAgIG1kLmFwcGVuZChmIiMjIEFzc2lzdGFudCAoe3RpbWVzdGFtcH0pXG4iKQogICAgICAgICAgICBtZC5hcHBlbmQoZiJ7Y29udGVudH1cbiIpCgogICAgcmV0dXJuICJcbiIuam9pbihtZCkKCgpkZWYgc3luY19zZXNzaW9ucyhhcmdzKSAtPiBkaWN0OgogICAgIiIi7IS47IWYIOuPmeq4sO2ZlCIiIgogICAgc3RhdHMgPSB7InN5bmNlZCI6IDAsICJza2lwcGVkIjogMCwgImVycm9ycyI6IDB9CgogICAgbWFjaGluZXMgPSBNQUNISU5FUwogICAgaWYgYXJncy5tYWNoaW5lOgogICAgICAgIGlmIGFyZ3MubWFjaGluZSBpbiBNQUNISU5FUzoKICAgICAgICAgICAgbWFjaGluZXMgPSB7YXJncy5tYWNoaW5lOiBNQUNISU5FU1thcmdzLm1hY2hpbmVdfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiVW5rbm93biBtYWNoaW5lOiB7YXJncy5tYWNoaW5lfSIpCiAgICAgICAgICAgIHJldHVybiBzdGF0cwoKICAgIGZvciBtYWNoaW5lX25hbWUsIG1hY2hpbmVfY29uZmlnIGluIG1hY2hpbmVzLml0ZW1zKCk6CiAgICAgICAgcHJpbnQoZiJcblt7bWFjaGluZV9uYW1lfV0iKQoKICAgICAgICBpZiBtYWNoaW5lX2NvbmZpZ1sidHlwZSJdID09ICJsb2NhbCI6CiAgICAgICAgICAgIGNsYXVkZV9wcm9qZWN0cyA9IFBhdGguaG9tZSgpIC8gIi5jbGF1ZGUiIC8gInByb2plY3RzIgogICAgICAgICAgICBpZiBub3QgY2xhdWRlX3Byb2plY3RzLmV4aXN0cygpOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIFtXQVJOXSB7Y2xhdWRlX3Byb2plY3RzfSBub3QgZm91bmQiKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcHJvamVjdF9kaXJzID0gW2QgZm9yIGQgaW4gY2xhdWRlX3Byb2plY3RzLml0ZXJkaXIoKSBpZiBkLmlzX2RpcigpXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhvc3QgPSBtYWNoaW5lX2NvbmZpZ1siaG9zdCJdCiAgICAgICAgICAgIHJjLCBzdGRvdXQsIF8gPSBydW5fc3NoKGhvc3QsICJscyAtMWQgfi8uY2xhdWRlL3Byb2plY3RzLyovIDI+L2Rldi9udWxsIikKICAgICAgICAgICAgaWYgcmMgIT0gMDoKICAgICAgICAgICAgICAgIHByaW50KGYiICBbV0FSTl0gQ2Fubm90IGFjY2VzcyB+Ly5jbGF1ZGUvcHJvamVjdHMgb24ge2hvc3R9IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHByb2plY3RfZGlycyA9IFtQYXRoKHAuc3RyaXAoKSkgZm9yIHAgaW4gc3Rkb3V0LnN0cmlwKCkuc3BsaXQoIlxuIikgaWYgcC5zdHJpcCgpXQoKICAgICAgICBmb3IgcHJvamVjdF9kaXIgaW4gcHJvamVjdF9kaXJzOgogICAgICAgICAgICAjIHdvcmtzcGFjZSDtlITroZzsoJ3tirjrp4wKICAgICAgICAgICAgaWYgIndvcmtzcGFjZSIgbm90IGluIHN0cihwcm9qZWN0X2Rpcik6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgIyDtlITroZzsoJ3tirjrqoUg7LaU7LacIChOb25l7J2066m0IOyKpO2CtSkKICAgICAgICAgICAgcHJvamVjdF9pbmZvID0gZXh0cmFjdF9wcm9qZWN0X2luZm8ocHJvamVjdF9kaXIubmFtZSwgbWFjaGluZV9jb25maWdbInR5cGUiXSkKICAgICAgICAgICAgaWYgcHJvamVjdF9pbmZvIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIFtTS0lQXSB7cHJvamVjdF9kaXIubmFtZX0gKHdvcmtzcGFjZSByb290KSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgcHJvamVjdF9uYW1lLCB2YXVsdF9iYXNlX2RpciA9IHByb2plY3RfaW5mbwoKICAgICAgICAgICAgIyDtlITroZzsoJ3tirgg7ZWE7YSwCiAgICAgICAgICAgIGlmIGFyZ3MucHJvamVjdCBhbmQgcHJvamVjdF9uYW1lICE9IGFyZ3MucHJvamVjdDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICB0YXJnZXRfZGlyID0gdmF1bHRfYmFzZV9kaXIgLyBwcm9qZWN0X25hbWUgLyAic2Vzc2lvbnMiCgogICAgICAgICAgICAjIOyEuOyFmCDtjIzsnbwg66qp66GdCiAgICAgICAgICAgIGlmIG1hY2hpbmVfY29uZmlnWyJ0eXBlIl0gPT0gImxvY2FsIjoKICAgICAgICAgICAgICAgIHNlc3Npb25fZmlsZXMgPSBsaXN0KHByb2plY3RfZGlyLmdsb2IoIiouanNvbmwiKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGZpbGVzID0gW10KICAgICAgICAgICAgICAgIHJjLCBzdGRvdXQsIF8gPSBydW5fc3NoKG1hY2hpbmVfY29uZmlnWyJob3N0Il0sIGYibHMgLTEge3Byb2plY3RfZGlyfS8qLmpzb25sIDI+L2Rldi9udWxsIikKICAgICAgICAgICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgICAgICAgICAgZmlsZXMgPSBbUGF0aChmKSBmb3IgZiBpbiBzdGRvdXQuc3RyaXAoKS5zcGxpdCgiXG4iKSBpZiBmLnN0cmlwKCldCiAgICAgICAgICAgICAgICBzZXNzaW9uX2ZpbGVzID0gZmlsZXMKCiAgICAgICAgICAgIGZvciBzZXNzaW9uX2ZpbGUgaW4gc2Vzc2lvbl9maWxlczoKICAgICAgICAgICAgICAgIGlmIHNlc3Npb25fZmlsZS5uYW1lID09ICJzZXNzaW9ucy1pbmRleC5qc29ubCI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBzZXNzaW9uX2lkID0gc2Vzc2lvbl9maWxlLnN0ZW0KCiAgICAgICAgICAgICAgICAjIOuCtOyaqSDrqLzsoIAg7J296riwICjrgqDsp5wg7LaU7LacIO2VhOyalCkKICAgICAgICAgICAgICAgIGlmIG1hY2hpbmVfY29uZmlnWyJ0eXBlIl0gPT0gImxvY2FsIjoKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gc2Vzc2lvbl9maWxlLnJlYWRfdGV4dChlbmNvZGluZz0idXRmLTgiKQogICAgICAgICAgICAgICAgICAgIHNvdXJjZV9tdGltZSA9IHNlc3Npb25fZmlsZS5zdGF0KCkuc3RfbXRpbWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmMsIGNvbnRlbnQsIF8gPSBydW5fc3NoKG1hY2hpbmVfY29uZmlnWyJob3N0Il0sIGYiY2F0ICd7c2Vzc2lvbl9maWxlfSciKQogICAgICAgICAgICAgICAgICAgIGlmIHJjICE9IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzWyJlcnJvcnMiXSArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgIyDsm5Dqsqk6IG10aW1lIOqwgOyguOyYpOq4sAogICAgICAgICAgICAgICAgICAgIHJjLCBzdGRvdXQsIF8gPSBydW5fc3NoKAogICAgICAgICAgICAgICAgICAgICAgICBtYWNoaW5lX2NvbmZpZ1siaG9zdCJdLAogICAgICAgICAgICAgICAgICAgICAgICBmInN0YXQgLWYgJW0gJ3tzZXNzaW9uX2ZpbGV9JyAyPi9kZXYvbnVsbCB8fCBzdGF0IC1jICVZICd7c2Vzc2lvbl9maWxlfScgMj4vZGV2L251bGwiCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHNvdXJjZV9tdGltZSA9IGZsb2F0KHN0ZG91dC5zdHJpcCgpKSBpZiByYyA9PSAwIGFuZCBzdGRvdXQuc3RyaXAoKSBlbHNlIDAKCiAgICAgICAgICAgICAgICBtZXNzYWdlcyA9IHBhcnNlX2pzb25sKGNvbnRlbnQpCgogICAgICAgICAgICAgICAgIyDshLjshZgg64Kg7KecIOy2lOy2nCAo7LKrIOuplOyLnOyngOydmCDtg4DsnoTsiqTtg6ztlIQpCiAgICAgICAgICAgICAgICBzZXNzaW9uX2RhdGUgPSBOb25lCiAgICAgICAgICAgICAgICBmb3IgbXNnIGluIG1lc3NhZ2VzOgogICAgICAgICAgICAgICAgICAgIHRzID0gbXNnLmdldCgidGltZXN0YW1wIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdCh0cy5yZXBsYWNlKCJaIiwgIiswMDowMCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9kYXRlID0gZHQuc3RyZnRpbWUoIiVZLSVtLSVkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uX2RhdGU6CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9kYXRlID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZLSVtLSVkIikKCiAgICAgICAgICAgICAgICAjIO2MjOydvOuqhSDsg53shLEgKFlZWVktTU0tREQte3Nlc3Npb25faWR9IO2YleyLnSkKICAgICAgICAgICAgICAgIGlmIG1hY2hpbmVfbmFtZSAhPSAibG9jYWwiOgogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZiJ7c2Vzc2lvbl9kYXRlfS17bWFjaGluZV9uYW1lfV97c2Vzc2lvbl9pZH0ubWQiCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZiJ7c2Vzc2lvbl9kYXRlfS17c2Vzc2lvbl9pZH0ubWQiCiAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IHRhcmdldF9kaXIgLyBmaWxlbmFtZQoKICAgICAgICAgICAgICAgICMg6riw7KG0IO2MjOydvCDsspjrpqwKICAgICAgICAgICAgICAgIGlmIHRhcmdldF9maWxlLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgIGlmIGFyZ3MuZm9yY2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MgICMg642u7Ja07JOw6riwCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X210aW1lID0gdGFyZ2V0X2ZpbGUuc3RhdCgpLnN0X210aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNvdXJjZV9tdGltZSA8PSB0YXJnZXRfbXRpbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1sic2tpcHBlZCJdICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICMgc291cmNl6rCAIOuNlCDsg4jroZzsmrDrqbQg7JeF642w7J207Yq4IOynhO2WiQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgW1VQREFURV0ge3Byb2plY3RfbmFtZX0vc2Vzc2lvbnMve2ZpbGVuYW1lfSAoc291cmNlIG5ld2VyKSIpCgogICAgICAgICAgICAgICAgbWRfY29udGVudCA9IGNvbnZlcnRfc2Vzc2lvbl90b19tYXJrZG93bihzZXNzaW9uX2lkLCBtZXNzYWdlcywgcHJvamVjdF9uYW1lLCBtYWNoaW5lX25hbWUpCgogICAgICAgICAgICAgICAgaWYgbWRfY29udGVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHN0YXRzWyJza2lwcGVkIl0gKz0gMQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbRFJZLVJVTl0ge3Byb2plY3RfbmFtZX0vc2Vzc2lvbnMve2ZpbGVuYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9kaXIubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlLndyaXRlX3RleHQobWRfY29udGVudCwgZW5jb2Rpbmc9InV0Zi04IikKICAgICAgICAgICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbU1lOQ10ge3Byb2plY3RfbmFtZX0vc2Vzc2lvbnMve2ZpbGVuYW1lfSIpCgogICAgICAgICAgICAgICAgc3RhdHNbInN5bmNlZCJdICs9IDEKCiAgICAgICAgcHJpbnQoZiIgIFNlc3Npb25zOiB7c3RhdHNbJ3N5bmNlZCddfSBzeW5jZWQsIHtzdGF0c1snc2tpcHBlZCddfSBza2lwcGVkIikKCiAgICByZXR1cm4gc3RhdHMKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDbGVhbnVwIENvbW1hbmQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgY2xlYW51cF9zZXNzaW9ucyhhcmdzKSAtPiBkaWN0OgogICAgIiIi7IS47IWYIOygleumrCIiIgogICAgc3RhdHMgPSB7ImRlbGV0ZWQiOiAwLCAid2FybXVwIjogMCwgImZpeGVkIjogMH0KCiAgICBwYXR0ZXJucyA9IFsKICAgICAgICBXT1JLU1BBQ0VfRElSLmdsb2IoIiovc2Vzc2lvbnMvKiovKi5tZCIpLAogICAgICAgIFdPUktTUEFDRV9WSUJFX0RJUi5nbG9iKCIqL3Nlc3Npb25zLyoqLyoubWQiKSwKICAgICAgICBXT1JLU1BBQ0VfRVhUX0RJUi5nbG9iKCIqL3Nlc3Npb25zLyoqLyoubWQiKSwKICAgIF0KCiAgICBhbGxfZmlsZXMgPSBbXQogICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgYWxsX2ZpbGVzLmV4dGVuZChwYXR0ZXJuKQoKICAgIHByaW50KGYiU2Nhbm5pbmcge2xlbihhbGxfZmlsZXMpfSBzZXNzaW9uIGZpbGVzLi4uIikKCiAgICBmb3IgZmlsZV9wYXRoIGluIGFsbF9maWxlczoKICAgICAgICBpZiBhcmdzLnByb2plY3QgYW5kIGFyZ3MucHJvamVjdCBub3QgaW4gc3RyKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHRyeToKICAgICAgICAgICAgY29udGVudCA9IGZpbGVfcGF0aC5yZWFkX3RleHQoZW5jb2Rpbmc9InV0Zi04IikKCiAgICAgICAgICAgICMgV2FybXVwIOyEuOyFmCDsgq3soJwKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKHIndGl0bGU6XHMqIj9XYXJtdXAiPycsIGNvbnRlbnQsIHJlLklHTk9SRUNBU0UpOgogICAgICAgICAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbV0FSTVVQXSB7ZmlsZV9wYXRoLm5hbWV9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmlsZV9wYXRoLnVubGluaygpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIERlbGV0ZWQgd2FybXVwOiB7ZmlsZV9wYXRoLm5hbWV9IikKICAgICAgICAgICAgICAgIHN0YXRzWyJ3YXJtdXAiXSArPSAxCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgIyDstZzshowg64K07JqpIOyytO2BrAogICAgICAgICAgICBmbV9tYXRjaCA9IHJlLm1hdGNoKHIiXi0tLVxuW1xzXFNdKj9cbi0tLVxuKFtcc1xTXSopJCIsIGNvbnRlbnQpCiAgICAgICAgICAgIGlmIGZtX21hdGNoOgogICAgICAgICAgICAgICAgYm9keSA9IGZtX21hdGNoLmdyb3VwKDEpCiAgICAgICAgICAgICAgICBjb250ZW50X2xpbmVzID0gW2wgZm9yIGwgaW4gYm9keS5zcGxpdCgiXG4iKSBpZiBsLnN0cmlwKCkgYW5kIG5vdCBsLnN0YXJ0c3dpdGgoIiMiKV0KICAgICAgICAgICAgICAgIGlmIGxlbihjb250ZW50X2xpbmVzKSA8IDM6CiAgICAgICAgICAgICAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgW0VNUFRZXSB7ZmlsZV9wYXRoLm5hbWV9IikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGgudW5saW5rKCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIERlbGV0ZWQgZW1wdHk6IHtmaWxlX3BhdGgubmFtZX0iKQogICAgICAgICAgICAgICAgICAgIHN0YXRzWyJkZWxldGVkIl0gKz0gMQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIFlBTUwg65Sw7Ji07ZGcIOyImOyglQogICAgICAgICAgICBpZiAndGl0bGU6ICInIGluIGNvbnRlbnQ6CiAgICAgICAgICAgICAgICB0aXRsZV9tYXRjaCA9IHJlLnNlYXJjaChyJ14odGl0bGU6XHMqKSIoLispIiQnLCBjb250ZW50LCByZS5NVUxUSUxJTkUpCiAgICAgICAgICAgICAgICBpZiB0aXRsZV9tYXRjaCBhbmQgJyInIGluIHRpdGxlX21hdGNoLmdyb3VwKDIpOgogICAgICAgICAgICAgICAgICAgIGlmIGFyZ3MuZHJ5X3J1bjoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIFtGSVhdIHtmaWxlX3BhdGgubmFtZX0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGVzY2FwZWQgPSB0aXRsZV9tYXRjaC5ncm91cCgyKS5yZXBsYWNlKCciJywgJ1xcIicpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkID0gcmUuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcideKHRpdGxlOlxzKikiKC4rKSIkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYnXFwxIntlc2NhcGVkfSInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzPXJlLk1VTFRJTElORQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aC53cml0ZV90ZXh0KGZpeGVkLCBlbmNvZGluZz0idXRmLTgiKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgRml4ZWQgWUFNTDoge2ZpbGVfcGF0aC5uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgc3RhdHNbImZpeGVkIl0gKz0gMQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KGYiICBbRVJST1JdIHtmaWxlX3BhdGgubmFtZX06IHtlfSIpCgogICAgcmV0dXJuIHN0YXRzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgVGFncyBDb21tYW5kCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGRldGVjdF9kb2N1bWVudF90eXBlKGZpbGVuYW1lOiBzdHIsIGNvbnRlbnQ6IHN0cikgLT4gc3RyOgogICAgIiIi66y47IScIOycoO2YlSDqsJDsp4AiIiIKICAgIGZvciBwYXR0ZXJuLCBkb2NfdHlwZSBpbiBUWVBFX1BBVFRFUk5TOgogICAgICAgIGlmIHJlLnNlYXJjaChwYXR0ZXJuLCBmaWxlbmFtZSwgcmUuSUdOT1JFQ0FTRSk6CiAgICAgICAgICAgIHJldHVybiBkb2NfdHlwZQogICAgICAgIGlmIHJlLnNlYXJjaChwYXR0ZXJuLCBjb250ZW50Wzo1MDBdLCByZS5JR05PUkVDQVNFKToKICAgICAgICAgICAgcmV0dXJuIGRvY190eXBlCiAgICByZXR1cm4gImNvbnRleHQiCgoKZGVmIGV4dHJhY3RfdG9waWNfdGFncyhjb250ZW50OiBzdHIpIC0+IGxpc3Rbc3RyXToKICAgICIiIu2GoO2UvSDtg5zqt7gg7LaU7LacIiIiCiAgICB0YWdzID0gc2V0KCkKICAgIGZvciBwYXR0ZXJuLCB0YWcgaW4gVE9QSUNfVEFHUzoKICAgICAgICBpZiByZS5zZWFyY2gocGF0dGVybiwgY29udGVudCwgcmUuSUdOT1JFQ0FTRSk6CiAgICAgICAgICAgIHRhZ3MuYWRkKHRhZykKICAgIHJldHVybiBsaXN0KHRhZ3MpCgoKZGVmIGRldGVjdF9zdGF0dXMoY29udGVudDogc3RyKSAtPiBzdHI6CiAgICAiIiLsg4Htg5wg6rCQ7KeAIiIiCiAgICBmb3IgcGF0dGVybiwgc3RhdHVzIGluIFNUQVRVU19QQVRURVJOUzoKICAgICAgICBpZiByZS5zZWFyY2gocGF0dGVybiwgY29udGVudFs6MTAwMF0sIHJlLklHTk9SRUNBU0UpOgogICAgICAgICAgICByZXR1cm4gc3RhdHVzCiAgICByZXR1cm4gImNvbXBsZXRlZCIKCgpkZWYgZW5oYW5jZV90YWdzKGFyZ3MpIC0+IGRpY3Q6CiAgICAiIiLtg5zqt7gg7J6Q64+ZIOy2lOqwgCIiIgogICAgc3RhdHMgPSB7InVwZGF0ZWQiOiAwLCAic2Nhbm5lZCI6IDB9CgogICAgIyBjb250ZXh0IOusuOyEnOunjCDrjIDsg4EKICAgIHBhdHRlcm5zID0gbGlzdChXT1JLU1BBQ0VfRElSLmdsb2IoIiovY29udGV4dC8qKi8qLm1kIikpCiAgICBwYXR0ZXJucy5leHRlbmQoV09SS1NQQUNFX1ZJQkVfRElSLmdsb2IoIiovY29udGV4dC8qKi8qLm1kIikpCiAgICBwYXR0ZXJucy5leHRlbmQoV09SS1NQQUNFX0VYVF9ESVIuZ2xvYigiKi9jb250ZXh0LyoqLyoubWQiKSkKCiAgICBwcmludChmIlNjYW5uaW5nIHtsZW4ocGF0dGVybnMpfSBjb250ZXh0IGZpbGVzLi4uIikKCiAgICBmb3IgZmlsZV9wYXRoIGluIHBhdHRlcm5zOgogICAgICAgIGlmIGZpbGVfcGF0aC5uYW1lID09ICJJTkRFWC5tZCI6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGlmIGFyZ3MucHJvamVjdDoKICAgICAgICAgICAgcGFydHMgPSBmaWxlX3BhdGgucGFydHMKICAgICAgICAgICAgd3NfaWR4ID0gcGFydHMuaW5kZXgoIndvcmtzcGFjZSIpIGlmICJ3b3Jrc3BhY2UiIGluIHBhcnRzIGVsc2UgLTEKICAgICAgICAgICAgaWYgd3NfaWR4ID49IDAgYW5kIHBhcnRzW3dzX2lkeCArIDFdICE9IGFyZ3MucHJvamVjdDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHN0YXRzWyJzY2FubmVkIl0gKz0gMQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbnRlbnQgPSBmaWxlX3BhdGgucmVhZF90ZXh0KGVuY29kaW5nPSJ1dGYtOCIpCgogICAgICAgICAgICAjIGZyb250bWF0dGVyIO2MjOyLsQogICAgICAgICAgICBmbV9tYXRjaCA9IHJlLm1hdGNoKHIiXi0tLVxuKFtcc1xTXSo/KVxuLS0tXG4oW1xzXFNdKikkIiwgY29udGVudCkKICAgICAgICAgICAgaWYgbm90IGZtX21hdGNoOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGZtX2NvbnRlbnQgPSBmbV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICBib2R5ID0gZm1fbWF0Y2guZ3JvdXAoMikKCiAgICAgICAgICAgICMg6riw7KG0IO2DnOq3uCDstpTstpwKICAgICAgICAgICAgdGFnc19tYXRjaCA9IHJlLnNlYXJjaChyIl50YWdzOlxzKlxbKFteXF1dKilcXSIsIGZtX2NvbnRlbnQsIHJlLk1VTFRJTElORSkKICAgICAgICAgICAgZXhpc3RpbmdfdGFncyA9IFtdCiAgICAgICAgICAgIGlmIHRhZ3NfbWF0Y2g6CiAgICAgICAgICAgICAgICBleGlzdGluZ190YWdzID0gW3Quc3RyaXAoKS5zdHJpcCgnIlwnJykgZm9yIHQgaW4gdGFnc19tYXRjaC5ncm91cCgxKS5zcGxpdCgiLCIpIGlmIHQuc3RyaXAoKV0KCiAgICAgICAgICAgICMg7IOIIO2DnOq3uCDstpTstpwKICAgICAgICAgICAgbmV3X3RhZ3MgPSBzZXQoZXhpc3RpbmdfdGFncykKICAgICAgICAgICAgbmV3X3RhZ3MudXBkYXRlKGV4dHJhY3RfdG9waWNfdGFncyhib2R5KSkKCiAgICAgICAgICAgICMg66y47IScIOycoO2YlQogICAgICAgICAgICBkb2NfdHlwZSA9IGRldGVjdF9kb2N1bWVudF90eXBlKGZpbGVfcGF0aC5uYW1lLCBib2R5KQogICAgICAgICAgICBuZXdfdGFncy5hZGQoZG9jX3R5cGUpCgogICAgICAgICAgICAjIO2UhOuhnOygne2KuOuqhQogICAgICAgICAgICBwYXJ0cyA9IGZpbGVfcGF0aC5wYXJ0cwogICAgICAgICAgICB3c19pZHggPSBwYXJ0cy5pbmRleCgid29ya3NwYWNlIikgaWYgIndvcmtzcGFjZSIgaW4gcGFydHMgZWxzZSAtMQogICAgICAgICAgICBpZiB3c19pZHggPj0gMDoKICAgICAgICAgICAgICAgIG5ld190YWdzLmFkZChwYXJ0c1t3c19pZHggKyAxXSkKCiAgICAgICAgICAgIG5ld190YWdzLmFkZCgiY29udGV4dCIpCgogICAgICAgICAgICAjIOuzgOqyvSDtmZXsnbgKICAgICAgICAgICAgc29ydGVkX25ldyA9IHNvcnRlZChuZXdfdGFncykKICAgICAgICAgICAgc29ydGVkX29sZCA9IHNvcnRlZChleGlzdGluZ190YWdzKQoKICAgICAgICAgICAgaWYgc29ydGVkX25ldyAhPSBzb3J0ZWRfb2xkOgogICAgICAgICAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICAgICAgICAgIGFkZGVkID0gW3QgZm9yIHQgaW4gc29ydGVkX25ldyBpZiB0IG5vdCBpbiBzb3J0ZWRfb2xkXQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbRFJZLVJVTl0ge2ZpbGVfcGF0aC5uYW1lfTogK3thZGRlZH0iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0YWdzX3N0ciA9ICIsICIuam9pbihzb3J0ZWRfbmV3KQogICAgICAgICAgICAgICAgICAgIGlmIHRhZ3NfbWF0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19mbSA9IHJlLnN1YigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIiXnRhZ3M6XHMqXFtbXlxdXSpcXSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmInRhZ3M6IFt7dGFnc19zdHJ9XSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbV9jb250ZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3M9cmUuTVVMVElMSU5FCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfZm0gPSBmbV9jb250ZW50ICsgZiJcbnRhZ3M6IFt7dGFnc19zdHJ9XSIKCiAgICAgICAgICAgICAgICAgICAgbmV3X2NvbnRlbnQgPSBmIi0tLVxue25ld19mbX1cbi0tLVxue2JvZHl9IgogICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aC53cml0ZV90ZXh0KG5ld19jb250ZW50LCBlbmNvZGluZz0idXRmLTgiKQogICAgICAgICAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIFVwZGF0ZWQ6IHtmaWxlX3BhdGgubmFtZX0iKQoKICAgICAgICAgICAgICAgIHN0YXRzWyJ1cGRhdGVkIl0gKz0gMQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KGYiICBbRVJST1JdIHtmaWxlX3BhdGgubmFtZX06IHtlfSIpCgogICAgcmV0dXJuIHN0YXRzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTWlncmF0ZSBDb21tYW5kCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIG1pZ3JhdGVfc2Vzc2lvbl9maWxlbmFtZXMoYXJncykgLT4gZGljdDoKICAgICIiIuq4sOyhtCDshLjshZgg7YyM7J2866qF7J2EIFlZWVktTU0tREQte2lkfSDtmJXsi53snLzroZwg66eI7J206re466CI7J207IWYIiIiCiAgICBzdGF0cyA9IHsibWlncmF0ZWQiOiAwLCAic2tpcHBlZCI6IDAsICJlcnJvcnMiOiAwfQoKICAgIHBhdHRlcm5zID0gWwogICAgICAgIFdPUktTUEFDRV9ESVIuZ2xvYigiKi9zZXNzaW9ucy8qKi8qLm1kIiksCiAgICAgICAgV09SS1NQQUNFX1ZJQkVfRElSLmdsb2IoIiovc2Vzc2lvbnMvKiovKi5tZCIpLAogICAgICAgIFdPUktTUEFDRV9FWFRfRElSLmdsb2IoIiovc2Vzc2lvbnMvKiovKi5tZCIpLAogICAgXQoKICAgIGFsbF9maWxlcyA9IFtdCiAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICBhbGxfZmlsZXMuZXh0ZW5kKHBhdHRlcm4pCgogICAgcHJpbnQoZiJTY2FubmluZyB7bGVuKGFsbF9maWxlcyl9IHNlc3Npb24gZmlsZXMgZm9yIG1pZ3JhdGlvbi4uLiIpCgogICAgZm9yIGZpbGVfcGF0aCBpbiBhbGxfZmlsZXM6CiAgICAgICAgZmlsZW5hbWUgPSBmaWxlX3BhdGgubmFtZQoKICAgICAgICAjIOydtOuvuCDrgqDsp5wgcHJlZml46rCAIOyeiOycvOuptCDsiqTtgrUKICAgICAgICBpZiByZS5tYXRjaChyIl5cZHs0fS1cZHsyfS1cZHsyfS0iLCBmaWxlbmFtZSk6CiAgICAgICAgICAgIHN0YXRzWyJza2lwcGVkIl0gKz0gMQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIElOREVYLm1kIOyKpO2CtQogICAgICAgIGlmIGZpbGVuYW1lID09ICJJTkRFWC5tZCI6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHRyeToKICAgICAgICAgICAgY29udGVudCA9IGZpbGVfcGF0aC5yZWFkX3RleHQoZW5jb2Rpbmc9InV0Zi04IikKCiAgICAgICAgICAgICMgZnJvbnRtYXR0ZXLsl5DshJwgY3JlYXRlZCDrgqDsp5wg7LaU7LacCiAgICAgICAgICAgIGNyZWF0ZWRfbWF0Y2ggPSByZS5zZWFyY2gociJeY3JlYXRlZDpccyooLispJCIsIGNvbnRlbnQsIHJlLk1VTFRJTElORSkKICAgICAgICAgICAgaWYgY3JlYXRlZF9tYXRjaDoKICAgICAgICAgICAgICAgIGNyZWF0ZWRfc3RyID0gY3JlYXRlZF9tYXRjaC5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBJU08g7ZiV7IudIO2MjOyLsQogICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChjcmVhdGVkX3N0ci5yZXBsYWNlKCJaIiwgIiswMDowMCIpKQogICAgICAgICAgICAgICAgICAgIGRhdGVfcHJlZml4ID0gZHQuc3RyZnRpbWUoIiVZLSVtLSVkIikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAjIOuLpOuluCDtmJXsi50g7Iuc64+ECiAgICAgICAgICAgICAgICAgICAgZGF0ZV9tYXRjaCA9IHJlLm1hdGNoKHIiKFxkezR9LVxkezJ9LVxkezJ9KSIsIGNyZWF0ZWRfc3RyKQogICAgICAgICAgICAgICAgICAgIGlmIGRhdGVfbWF0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVfcHJlZml4ID0gZGF0ZV9tYXRjaC5ncm91cCgxKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVfcHJlZml4ID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZLSVtLSVkIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgZnJvbnRtYXR0ZXLsl5Ag64Kg7Kec6rCAIOyXhuycvOuptCDtjIzsnbwg7IiY7KCVIOyLnOqwhCDsgqzsmqkKICAgICAgICAgICAgICAgIG10aW1lID0gZmlsZV9wYXRoLnN0YXQoKS5zdF9tdGltZQogICAgICAgICAgICAgICAgZGF0ZV9wcmVmaXggPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKG10aW1lKS5zdHJmdGltZSgiJVktJW0tJWQiKQoKICAgICAgICAgICAgIyDsg4gg7YyM7J2866qFIOyDneyEsQogICAgICAgICAgICBuZXdfZmlsZW5hbWUgPSBmIntkYXRlX3ByZWZpeH0te2ZpbGVuYW1lfSIKICAgICAgICAgICAgbmV3X3BhdGggPSBmaWxlX3BhdGgucGFyZW50IC8gbmV3X2ZpbGVuYW1lCgogICAgICAgICAgICAjIOydtOuvuCDqsJnsnYAg7J2066aE7J2YIO2MjOydvOydtCDsnojsnLzrqbQg7Iqk7YK1CiAgICAgICAgICAgIGlmIG5ld19wYXRoLmV4aXN0cygpOgogICAgICAgICAgICAgICAgaWYgYXJncy52ZXJib3NlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbU0tJUF0ge2ZpbGVuYW1lfSAodGFyZ2V0IGV4aXN0cykiKQogICAgICAgICAgICAgICAgc3RhdHNbInNraXBwZWQiXSArPSAxCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIFtNSUdSQVRFXSB7ZmlsZW5hbWV9IOKGkiB7bmV3X2ZpbGVuYW1lfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBmaWxlX3BhdGgucmVuYW1lKG5ld19wYXRoKQogICAgICAgICAgICAgICAgaWYgYXJncy52ZXJib3NlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICBbTUlHUkFURV0ge2ZpbGVuYW1lfSDihpIge25ld19maWxlbmFtZX0iKQoKICAgICAgICAgICAgc3RhdHNbIm1pZ3JhdGVkIl0gKz0gMQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KGYiICBbRVJST1JdIHtmaWxlbmFtZX06IHtlfSIpCiAgICAgICAgICAgIHN0YXRzWyJlcnJvcnMiXSArPSAxCgogICAgcmV0dXJuIHN0YXRzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgUHVzaCBDb21tYW5kIChDb3VjaERCL0xpdmVTeW5jKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBnZW5lcmF0ZV9jaHVua19pZChkYXRhOiBzdHIpIC0+IHN0cjoKICAgICIiIuyyre2BrCDrjbDsnbTthLDroZzrtoDthLAg6rOg7JygIElEIOyDneyEsSIiIgogICAgaGFzaF92YWwgPSBoYXNobGliLm1kNShkYXRhLmVuY29kZSgndXRmLTgnKSkuaGV4ZGlnZXN0KCkKICAgICMgTGl2ZVN5bmMg7Iqk7YOA7J28IElEOiBiYXNlMzYg7J247L2U65SpCiAgICBudW0gPSBpbnQoaGFzaF92YWxbOjEyXSwgMTYpCiAgICBjaGFycyA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiCiAgICByZXN1bHQgPSAiIgogICAgd2hpbGUgbnVtOgogICAgICAgIHJlc3VsdCA9IGNoYXJzW251bSAlIDM2XSArIHJlc3VsdAogICAgICAgIG51bSAvLz0gMzYKICAgIHJldHVybiBmImg6e3Jlc3VsdCBvciAnMCd9IgoKCmRlZiBjb3VjaGRiX3JlcXVlc3QobWV0aG9kOiBzdHIsIHBhdGg6IHN0ciwgZGF0YTogZGljdCA9IE5vbmUpIC0+IHR1cGxlW2ludCwgZGljdF06CiAgICAiIiJDb3VjaERCIEhUVFAg7JqU7LKtIiIiCiAgICB1cmwgPSBmIntDT1VDSERCX1VSSX0ve0NPVUNIREJfREJOQU1FfS97cGF0aH0iCgogICAgIyBCYXNpYyBBdXRoCiAgICBjcmVkZW50aWFscyA9IGJhc2U2NC5iNjRlbmNvZGUoZiJ7Q09VQ0hEQl9VU0VSfTp7Q09VQ0hEQl9QQVNTV09SRH0iLmVuY29kZSgpKS5kZWNvZGUoKQogICAgaGVhZGVycyA9IHsKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IGYiQmFzaWMge2NyZWRlbnRpYWxzfSIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgIH0KCiAgICBib2R5ID0ganNvbi5kdW1wcyhkYXRhKS5lbmNvZGUoJ3V0Zi04JykgaWYgZGF0YSBlbHNlIE5vbmUKCiAgICByZXEgPSB1cmxsaWIucmVxdWVzdC5SZXF1ZXN0KHVybCwgZGF0YT1ib2R5LCBoZWFkZXJzPWhlYWRlcnMsIG1ldGhvZD1tZXRob2QpCgogICAgdHJ5OgogICAgICAgIHdpdGggdXJsbGliLnJlcXVlc3QudXJsb3BlbihyZXEsIHRpbWVvdXQ9MzApIGFzIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzLCBqc29uLmxvYWRzKHJlc3BvbnNlLnJlYWQoKS5kZWNvZGUoJ3V0Zi04JykpCiAgICBleGNlcHQgdXJsbGliLmVycm9yLkhUVFBFcnJvciBhcyBlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGUuY29kZSwganNvbi5sb2FkcyhlLnJlYWQoKS5kZWNvZGUoJ3V0Zi04JykpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gZS5jb2RlLCB7ImVycm9yIjogc3RyKGUpfQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiAwLCB7ImVycm9yIjogc3RyKGUpfQoKCmRlZiBnZXRfY291Y2hkYl9kb2MoZG9jX2lkOiBzdHIpIC0+IE9wdGlvbmFsW2RpY3RdOgogICAgIiIiQ291Y2hEQuyXkOyEnCDrrLjshJwg6rCA7KC47Jik6riwIiIiCiAgICBzdGF0dXMsIHJlc3VsdCA9IGNvdWNoZGJfcmVxdWVzdCgiR0VUIiwgdXJsbGliLnJlcXVlc3QucXVvdGUoZG9jX2lkLCBzYWZlPScnKSkKICAgIGlmIHN0YXR1cyA9PSAyMDA6CiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgcmV0dXJuIE5vbmUKCgpkZWYgcHV0X2NvdWNoZGJfZG9jKGRvY19pZDogc3RyLCBkb2M6IGRpY3QpIC0+IGJvb2w6CiAgICAiIiJDb3VjaERC7JeQIOusuOyEnCDsoIDsnqUiIiIKICAgIHN0YXR1cywgcmVzdWx0ID0gY291Y2hkYl9yZXF1ZXN0KCJQVVQiLCB1cmxsaWIucmVxdWVzdC5xdW90ZShkb2NfaWQsIHNhZmU9JycpLCBkb2MpCiAgICByZXR1cm4gc3RhdHVzIGluIFsyMDAsIDIwMV0KCgpkZWYgcHVzaF9maWxlX3RvX2NvdWNoZGIoZmlsZV9wYXRoOiBQYXRoLCB2YXVsdF9yb290OiBQYXRoLCBhcmdzKSAtPiBib29sOgogICAgIiIi7YyM7J287J2EIENvdWNoRELsl5Ag7JeF66Gc65OcIChMaXZlU3luYyDtj6zrp7cpIiIiCiAgICB0cnk6CiAgICAgICAgIyDsg4HrjIAg6rK966GcIOqzhOyCsCAodmF1bHQg6riw7KSAKQogICAgICAgIHJlbF9wYXRoID0gc3RyKGZpbGVfcGF0aC5yZWxhdGl2ZV90byh2YXVsdF9yb290KSkKICAgICAgICBkb2NfaWQgPSByZWxfcGF0aC5sb3dlcigpICAjIExpdmVTeW5j64qUIOyGjOusuOyekCBJRCDsgqzsmqkKCiAgICAgICAgIyDtjIzsnbwg64K07JqpIOydveq4sAogICAgICAgIGNvbnRlbnQgPSBmaWxlX3BhdGgucmVhZF90ZXh0KGVuY29kaW5nPSd1dGYtOCcpCgogICAgICAgICMg7YyM7J28IOygleuztAogICAgICAgIHN0YXQgPSBmaWxlX3BhdGguc3RhdCgpCiAgICAgICAgbXRpbWUgPSBpbnQoc3RhdC5zdF9tdGltZSAqIDEwMDApCiAgICAgICAgY3RpbWUgPSBpbnQoc3RhdC5zdF9jdGltZSAqIDEwMDApCiAgICAgICAgc2l6ZSA9IGxlbihjb250ZW50LmVuY29kZSgndXRmLTgnKSkKCiAgICAgICAgIyDquLDsobQg66y47IScIO2ZleyduAogICAgICAgIGV4aXN0aW5nID0gZ2V0X2NvdWNoZGJfZG9jKGRvY19pZCkKCiAgICAgICAgIyDsiJjsoJUg7Iuc6rCEIOu5hOq1kCAo7J2066+4IOy1nOyLoOydtOuptCDsiqTtgrUpCiAgICAgICAgaWYgZXhpc3RpbmcgYW5kIG5vdCBhcmdzLmZvcmNlOgogICAgICAgICAgICBpZiBleGlzdGluZy5nZXQoIm10aW1lIiwgMCkgPj0gbXRpbWU6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UgICMg7Iqk7YK1CgogICAgICAgICMg64K07Jqp7J2EIOyyre2BrOuhnCDrtoTtlaAKICAgICAgICBjaHVua3MgPSBbXQogICAgICAgIGNodW5rX2lkcyA9IFtdCgogICAgICAgIGZvciBpIGluIHJhbmdlKDAsIGxlbihjb250ZW50KSwgQ0hVTktfU0laRSk6CiAgICAgICAgICAgIGNodW5rX2RhdGEgPSBjb250ZW50W2k6aStDSFVOS19TSVpFXQogICAgICAgICAgICBjaHVua19pZCA9IGdlbmVyYXRlX2NodW5rX2lkKGYie2RvY19pZH06e2l9OntjaHVua19kYXRhfSIpCgogICAgICAgICAgICAjIOyyre2BrCDrrLjshJwg7IOd7ISxCiAgICAgICAgICAgIGNodW5rX2RvYyA9IHsKICAgICAgICAgICAgICAgICJfaWQiOiBjaHVua19pZCwKICAgICAgICAgICAgICAgICJkYXRhIjogY2h1bmtfZGF0YSwKICAgICAgICAgICAgICAgICJ0eXBlIjogImxlYWYiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMg6riw7KG0IOyyre2BrCDtmZXsnbgKICAgICAgICAgICAgZXhpc3RpbmdfY2h1bmsgPSBnZXRfY291Y2hkYl9kb2MoY2h1bmtfaWQpCiAgICAgICAgICAgIGlmIGV4aXN0aW5nX2NodW5rOgogICAgICAgICAgICAgICAgY2h1bmtfZG9jWyJfcmV2Il0gPSBleGlzdGluZ19jaHVua1siX3JldiJdCgogICAgICAgICAgICBjaHVua3MuYXBwZW5kKGNodW5rX2RvYykKICAgICAgICAgICAgY2h1bmtfaWRzLmFwcGVuZChjaHVua19pZCkKCiAgICAgICAgIyDssq3tgazrk6Qg7KCA7J6lCiAgICAgICAgZm9yIGNodW5rIGluIGNodW5rczoKICAgICAgICAgICAgaWYgbm90IHB1dF9jb3VjaGRiX2RvYyhjaHVua1siX2lkIl0sIGNodW5rKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAjIOuplO2DgOuNsOydtO2EsCDrrLjshJwg7IOd7ISxCiAgICAgICAgbWV0YV9kb2MgPSB7CiAgICAgICAgICAgICJfaWQiOiBkb2NfaWQsCiAgICAgICAgICAgICJjaGlsZHJlbiI6IGNodW5rX2lkcywKICAgICAgICAgICAgInBhdGgiOiByZWxfcGF0aCwKICAgICAgICAgICAgImN0aW1lIjogY3RpbWUsCiAgICAgICAgICAgICJtdGltZSI6IG10aW1lLAogICAgICAgICAgICAic2l6ZSI6IHNpemUsCiAgICAgICAgICAgICJ0eXBlIjogInBsYWluIiwKICAgICAgICAgICAgImVkZW4iOiB7fSwKICAgICAgICAgICAgImRlbGV0ZWQiOiBGYWxzZQogICAgICAgIH0KCiAgICAgICAgaWYgZXhpc3Rpbmc6CiAgICAgICAgICAgIG1ldGFfZG9jWyJfcmV2Il0gPSBleGlzdGluZ1siX3JldiJdCgogICAgICAgIHJldHVybiBwdXRfY291Y2hkYl9kb2MoZG9jX2lkLCBtZXRhX2RvYykKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgaWYgYXJncy52ZXJib3NlOgogICAgICAgICAgICBwcmludChmIiAgW0VSUk9SXSB7ZmlsZV9wYXRoLm5hbWV9OiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBwdXNoX3RvX2NvdWNoZGIoYXJncykgLT4gZGljdDoKICAgICIiIuuzgOqyveuQnCDtjIzsnbzsnYQgQ291Y2hEQuyXkCDtkbjsi5wiIiIKICAgIHN0YXRzID0geyJwdXNoZWQiOiAwLCAic2tpcHBlZCI6IDAsICJlcnJvcnMiOiAwfQoKICAgICMgd29ya3NwYWNlIO2MjOydvOuTpCDsiJjsp5EKICAgIHBhdHRlcm5zID0gWwogICAgICAgIFdPUktTUEFDRV9ESVIuZ2xvYigiKiovKi5tZCIpLAogICAgICAgIFdPUktTUEFDRV9WSUJFX0RJUi5nbG9iKCIqKi8qLm1kIiksCiAgICAgICAgV09SS1NQQUNFX0VYVF9ESVIuZ2xvYigiKiovKi5tZCIpLAogICAgXQoKICAgIGFsbF9maWxlcyA9IFtdCiAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICBhbGxfZmlsZXMuZXh0ZW5kKHBhdHRlcm4pCgogICAgcHJpbnQoZiJTY2FubmluZyB7bGVuKGFsbF9maWxlcyl9IGZpbGVzIGZvciBwdXNoLi4uIikKCiAgICBmb3IgZmlsZV9wYXRoIGluIGFsbF9maWxlczoKICAgICAgICAjIC5vYnNpZGlhbiDtj7TrjZQg7KCc7Jm4CiAgICAgICAgaWYgIi5vYnNpZGlhbiIgaW4gZmlsZV9wYXRoLnBhcnRzOgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIO2UhOuhnOygne2KuCDtlYTthLAKICAgICAgICBpZiBhcmdzLnByb2plY3QgYW5kIGFyZ3MucHJvamVjdCBub3QgaW4gc3RyKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGlmIGFyZ3MuZHJ5X3J1bjoKICAgICAgICAgICAgcmVsX3BhdGggPSBmaWxlX3BhdGgucmVsYXRpdmVfdG8oVkFVTFRfUk9PVCkKICAgICAgICAgICAgcHJpbnQoZiIgIFtEUlktUlVOXSB7cmVsX3BhdGh9IikKICAgICAgICAgICAgc3RhdHNbInB1c2hlZCJdICs9IDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBwdXNoX2ZpbGVfdG9fY291Y2hkYihmaWxlX3BhdGgsIFZBVUxUX1JPT1QsIGFyZ3MpOgogICAgICAgICAgICAgICAgaWYgYXJncy52ZXJib3NlOgogICAgICAgICAgICAgICAgICAgIHJlbF9wYXRoID0gZmlsZV9wYXRoLnJlbGF0aXZlX3RvKFZBVUxUX1JPT1QpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIFtQVVNIXSB7cmVsX3BhdGh9IikKICAgICAgICAgICAgICAgIHN0YXRzWyJwdXNoZWQiXSArPSAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzdGF0c1sic2tpcHBlZCJdICs9IDEKCiAgICByZXR1cm4gc3RhdHMKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBQdWxsIENvbW1hbmQgKENvdWNoREIvTGl2ZVN5bmMpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGxpc3RfY291Y2hkYl9kb2NzKHByZWZpeDogc3RyID0gIiIpIC0+IGxpc3RbZGljdF06CiAgICAiIiJDb3VjaERC7JeQ7IScIOusuOyEnCDrqqnroZ0g6rCA7KC47Jik6riwIiIiCiAgICAjIF9hbGxfZG9jc+uhnCB3b3Jrc3BhY2Ug66y47ISc65Ok66eMIOqwgOyguOyYpOq4sAogICAgcGFyYW1zID0gImluY2x1ZGVfZG9jcz10cnVlIgogICAgaWYgcHJlZml4OgogICAgICAgIHBhcmFtcyArPSBmIiZzdGFydGtleT1cIntwcmVmaXh9XCImZW5ka2V5PVwie3ByZWZpeH1cXHVmZmYwXCIiCgogICAgc3RhdHVzLCByZXN1bHQgPSBjb3VjaGRiX3JlcXVlc3QoIkdFVCIsIGYiX2FsbF9kb2NzP3twYXJhbXN9IikKICAgIGlmIHN0YXR1cyAhPSAyMDA6CiAgICAgICAgcmV0dXJuIFtdCgogICAgZG9jcyA9IFtdCiAgICBmb3Igcm8=dyBpbiByZXN1bHQuZ2V0KCJyb3dzIiwgW10pOgogICAgICAgIGRvYyA9IHJvdy5nZXQoImRvYyIsIHt9KQogICAgICAgIGRvY19pZCA9IGRvYy5nZXQoIl9pZCIsICIiKQogICAgICAgICMgd29ya3NwYWNlIOusuOyEnOunjCDtlYTthLDrp4EgKGg6IOyyre2BrOyZgCDsi5zsiqTthZwg66y47IScIOygnOyZuCkKICAgICAgICBpZiBkb2NfaWQuc3RhcnRzd2l0aCgid29ya3NwYWNlIikgYW5kIGRvYy5nZXQoInR5cGUiKSA9PSAicGxhaW4iOgogICAgICAgICAgICBkb2NzLmFwcGVuZChkb2MpCgogICAgcmV0dXJuIGRvY3MKCgpkZWYgZmV0Y2hfZG9jX2NvbnRlbnQoZG9jOiBkaWN0KSAtPiBPcHRpb25hbFtzdHJdOgogICAgIiIiQ291Y2hEQuyXkOyEnCDrrLjshJwg64K07JqpIOqwgOyguOyYpOq4sCAo7LKt7YGsIOyerOyhsOumvSkiIiIKICAgIGNoaWxkcmVuID0gZG9jLmdldCgiY2hpbGRyZW4iLCBbXSkKICAgIGlmIG5vdCBjaGlsZHJlbjoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGNvbnRlbnRfcGFydHMgPSBbXQogICAgZm9yIGNodW5rX2lkIGluIGNoaWxkcmVuOgogICAgICAgIHN0YXR1cywgY2h1bmsgPSBjb3VjaGRiX3JlcXVlc3QoIkdFVCIsIHVybGxpYi5yZXF1ZXN0LnF1b3RlKGNodW5rX2lkLCBzYWZlPScnKSkKICAgICAgICBpZiBzdGF0dXMgPT0gMjAwIGFuZCAiZGF0YSIgaW4gY2h1bms6CiAgICAgICAgICAgIGNvbnRlbnRfcGFydHMuYXBwZW5kKGNodW5rWyJkYXRhIl0pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUgICMg7LKt7YGsIOuIhOudvQoKICAgIHJldHVybiAiIi5qb2luKGNvbnRlbnRfcGFydHMpCgoKZGVmIHB1bGxfZnJvbV9jb3VjaGRiKGFyZ3MpIC0+IGRpY3Q6CiAgICAiIiJDb3VjaERC7JeQ7IScIO2MjOydvCDqsIDsoLjsmKTquLAiIiIKICAgIHN0YXRzID0geyJwdWxsZWQiOiAwLCAic2tpcHBlZCI6IDAsICJlcnJvcnMiOiAwfQoKICAgIHByaW50KCJGZXRjaGluZyBkb2N1bWVudCBsaXN0IGZyb20gQ291Y2hEQi4uLiIpCgogICAgIyB3b3Jrc3BhY2Ug66y47ISc65OkIOqwgOyguOyYpOq4sAogICAgYWxsX2RvY3MgPSBbXQogICAgZm9yIHByZWZpeCBpbiBbIndvcmtzcGFjZS8iLCAid29ya3NwYWNlLXZpYmUvIiwgIndvcmtzcGFjZS1leHQvIl06CiAgICAgICAgZG9jcyA9IGxpc3RfY291Y2hkYl9kb2NzKHByZWZpeCkKICAgICAgICBhbGxfZG9jcy5leHRlbmQoZG9jcykKCiAgICBwcmludChmIkZvdW5kIHtsZW4oYWxsX2RvY3MpfSBkb2N1bWVudHMgaW4gQ291Y2hEQiIpCgogICAgZm9yIGRvYyBpbiBhbGxfZG9jczoKICAgICAgICBkb2NfaWQgPSBkb2MuZ2V0KCJfaWQiLCAiIikKICAgICAgICBwYXRoID0gZG9jLmdldCgicGF0aCIsIGRvY19pZCkKICAgICAgICByZW1vdGVfbXRpbWUgPSBkb2MuZ2V0KCJtdGltZSIsIDApCgogICAgICAgICMg7ZSE66Gc7KCd7Yq4IO2VhO2EsAogICAgICAgIGlmIGFyZ3MucHJvamVjdCBhbmQgYXJncy5wcm9qZWN0IG5vdCBpbiBwYXRoOgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIOuhnOy7rCDtjIzsnbwg6rK966GcCiAgICAgICAgbG9jYWxfcGF0aCA9IFZBVUxUX1JPT1QgLyBwYXRoCgogICAgICAgICMg66Gc7LusIO2MjOydvOydtCDrjZQg7IOI66Gc7Jqw66m0IOyKpO2CtQogICAgICAgIGlmIGxvY2FsX3BhdGguZXhpc3RzKCkgYW5kIG5vdCBhcmdzLmZvcmNlOgogICAgICAgICAgICBsb2NhbF9tdGltZSA9IGludChsb2NhbF9wYXRoLnN0YXQoKS5zdF9tdGltZSAqIDEwMDApCiAgICAgICAgICAgIGlmIGxvY2FsX210aW1lID49IHJlbW90ZV9tdGltZToKICAgICAgICAgICAgICAgIHN0YXRzWyJza2lwcGVkIl0gKz0gMQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgICAgICBwcmludChmIiAgW0RSWS1SVU5dIHtwYXRofSIpCiAgICAgICAgICAgIHN0YXRzWyJwdWxsZWQiXSArPSAxCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMg64K07JqpIOqwgOyguOyYpOq4sAogICAgICAgIGNvbnRlbnQgPSBmZXRjaF9kb2NfY29udGVudChkb2MpCiAgICAgICAgaWYgY29udGVudCBpcyBOb25lOgogICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2U6CiAgICAgICAgICAgICAgICBwcmludChmIiAgW0VSUk9SXSB7cGF0aH06IGZhaWxlZCB0byBmZXRjaCBjaHVua3MiKQogICAgICAgICAgICBzdGF0c1siZXJyb3JzIl0gKz0gMQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIO2MjOydvCDsoIDsnqUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvY2FsX3BhdGgucGFyZW50Lm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgbG9jYWxfcGF0aC53cml0ZV90ZXh0KGNvbnRlbnQsIGVuY29kaW5nPSJ1dGYtOCIpCiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KGYiICBbUFVMTF0ge3BhdGh9IikKICAgICAgICAgICAgc3RhdHNbInB1bGxlZCJdICs9IDEKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KGYiICBbRVJST1JdIHtwYXRofToge2V9IikKICAgICAgICAgICAgc3RhdHNbImVycm9ycyJdICs9IDEKCiAgICByZXR1cm4gc3RhdHMKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBXYXRjaCBDb21tYW5kIChMaXZlIFN5bmMpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGdldF9sb2NhbF9maWxlc19zdGF0ZSgpIC0+IGRpY3Rbc3RyLCBmbG9hdF06CiAgICAiIiLroZzsu6wg7YyM7J28IOyDge2DnCAobXRpbWUpIOyImOynkSIiIgogICAgc3RhdGUgPSB7fQogICAgZm9yIGJhc2VfZGlyIGluIFtXT1JLU1BBQ0VfRElSLCBXT1JLU1BBQ0VfVklCRV9ESVIsIFdPUktTUEFDRV9FWFRfRElSXToKICAgICAgICBpZiBub3QgYmFzZV9kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIG1kX2ZpbGUgaW4gYmFzZV9kaXIuZ2xvYigiKiovKi5tZCIpOgogICAgICAgICAgICBpZiAiLm9ic2lkaWFuIiBpbiBtZF9maWxlLnBhcnRzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcmVsX3BhdGggPSBzdHIobWRfZmlsZS5yZWxhdGl2ZV90byhWQVVMVF9ST09UKSkKICAgICAgICAgICAgc3RhdGVbcmVsX3BhdGhdID0gbWRfZmlsZS5zdGF0KCkuc3RfbXRpbWUKICAgIHJldHVybiBzdGF0ZQoKCmRlZiBnZXRfY291Y2hkYl9zZXEoKSAtPiBzdHI6CiAgICAiIiJDb3VjaERCIO2YhOyerCDsi5ztgIDsiqQg67KI7Zi4IiIiCiAgICBzdGF0dXMsIHJlc3VsdCA9IGNvdWNoZGJfcmVxdWVzdCgiR0VUIiwgIiIpCiAgICBpZiBzdGF0dXMgPT0gMjAwOgogICAgICAgIHJldHVybiByZXN1bHQuZ2V0KCJ1cGRhdGVfc2VxIiwgIjAiKQogICAgcmV0dXJuICIwIgoKCmRlZiB3YXRjaF9jb3VjaGRiX2NoYW5nZXMobGFzdF9zZXE6IHN0ciwgdGltZW91dDogaW50ID0gMzAwMDApIC0+IHR1cGxlW3N0ciwgbGlzdFtkaWN0XV06CiAgICAiIiJDb3VjaERCIOuzgOqyveyCrO2VrSDqsJDsp4AgKGxvbmcgcG9sbGluZykiIiIKICAgIHBhcmFtcyA9IGYic2luY2U9e2xhc3Rfc2VxfSZ0aW1lb3V0PXt0aW1lb3V0fSZpbmNsdWRlX2RvY3M9dHJ1ZSZmaWx0ZXI9X3ZpZXcmdmlldz13b3Jrc3BhY2UvZG9jcyIKCiAgICAjIOqwhOuLqO2VmOqyjCBfY2hhbmdlcyDsgqzsmqkgKGZpbHRlciDsl4bsnbQpCiAgICBwYXJhbXMgPSBmInNpbmNlPXtsYXN0X3NlcX0mdGltZW91dD17dGltZW91dH0maW5jbHVkZV9kb2NzPXRydWUiCgogICAgdHJ5OgogICAgICAgIHN0YXR1cywgcmVzdWx0ID0gY291Y2hkYl9yZXF1ZXN0KCJHRVQiLCBmIl9jaGFuZ2VzP3twYXJhbXN9IikKICAgICAgICBpZiBzdGF0dXMgPT0gMjAwOgogICAgICAgICAgICBuZXdfc2VxID0gcmVzdWx0LmdldCgibGFzdF9zZXEiLCBsYXN0X3NlcSkKICAgICAgICAgICAgY2hhbmdlcyA9IFtdCiAgICAgICAgICAgIGZvciBjaGFuZ2UgaW4gcmVzdWx0LmdldCgicmVzdWx0cyIsIFtdKToKICAgICAgICAgICAgICAgIGRvYyA9IGNoYW5nZS5nZXQoImRvYyIsIHt9KQogICAgICAgICAgICAgICAgZG9jX2lkID0gY2hhbmdlLmdldCgiaWQiLCAiIikKICAgICAgICAgICAgICAgICMgd29ya3NwYWNlIOusuOyEnOunjAogICAgICAgICAgICAgICAgaWYgZG9jX2lkLnN0YXJ0c3dpdGgoIndvcmtzcGFjZSIpIGFuZCBkb2MuZ2V0KCJ0eXBlIikgPT0gInBsYWluIjoKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzLmFwcGVuZChkb2MpCiAgICAgICAgICAgIHJldHVybiBuZXdfc2VxLCBjaGFuZ2VzCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHBhc3MKCiAgICByZXR1cm4gbGFzdF9zZXEsIFtdCgoKZGVmIHdhdGNoX2FuZF9zeW5jKGFyZ3MpOgogICAgIiIi7Iuk7Iuc6rCEIOyWkeuwqe2WpSDrj5nquLDtmZQiIiIKICAgIHByaW50KCJTdGFydGluZyBsaXZlIHN5bmMuLi4iLCBmbHVzaD1UcnVlKQogICAgcHJpbnQoZiJXYXRjaGluZzoge1ZBVUxUX1JPT1R9IiwgZmx1c2g9VHJ1ZSkKICAgIHByaW50KGYiQ291Y2hEQjoge0NPVUNIREJfVVJJfS97Q09VQ0hEQl9EQk5BTUV9IiwgZmx1c2g9VHJ1ZSkKICAgIHByaW50KCJQcmVzcyBDdHJsK0MgdG8gc3RvcFxuIiwgZmx1c2g9VHJ1ZSkKCiAgICAjIOy0iOq4sCDsg4Htg5wKICAgIGxvY2FsX3N0YXRlID0gZ2V0X2xvY2FsX2ZpbGVzX3N0YXRlKCkKICAgIGxhc3Rfc2VxID0gZ2V0X2NvdWNoZGJfc2VxKCkKCiAgICBwcmludChmIkxvY2FsIGZpbGVzOiB7bGVuKGxvY2FsX3N0YXRlKX0iLCBmbHVzaD1UcnVlKQogICAgcHJpbnQoZiJDb3VjaERCIHNlcToge2xhc3Rfc2VxWzo1MF19Li4uXG4iLCBmbHVzaD1UcnVlKQoKICAgIHBvbGxfaW50ZXJ2YWwgPSA1ICAjIOuhnOy7rCDtjIzsnbwg7LK07YGsIOqwhOqyqSAo7LSIKQogICAgbGFzdF9sb2NhbF9jaGVjayA9IHRpbWUudGltZSgpCgogICAgdHJ5OgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICMgPT09IENvdWNoREIg67OA6rK9IOqwkOyngCAobG9uZyBwb2xsaW5nLCAxMOy0iCDtg4DsnoTslYTsm4MpID09PQogICAgICAgICAgICBuZXdfc2VxLCByZW1vdGVfY2hhbmdlcyA9IHdhdGNoX2NvdWNoZGJfY2hhbmdlcyhsYXN0X3NlcSwgdGltZW91dD0xMDAwMCkKCiAgICAgICAgICAgIGlmIHJlbW90ZV9jaGFuZ2VzOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcbltSRU1PVEVdIHtsZW4ocmVtb3RlX2NoYW5nZXMpfSBjaGFuZ2VzIGRldGVjdGVkIiwgZmx1c2g9VHJ1ZSkKICAgICAgICAgICAgICAgIGZvciBkb2MgaW4gcmVtb3RlX2NoYW5nZXM6CiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGRvYy5nZXQoInBhdGgiLCBkb2MuZ2V0KCJfaWQiLCAiIikpCiAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aCA9IFZBVUxUX1JPT1QgLyBwYXRoCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlX210aW1lID0gZG9jLmdldCgibXRpbWUiLCAwKQoKICAgICAgICAgICAgICAgICAgICAjIOuhnOy7rOydtCDrjZQg7IOI66Gc7Jqw66m0IOyKpO2CtQogICAgICAgICAgICAgICAgICAgIGlmIGxvY2FsX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX210aW1lID0gaW50KGxvY2FsX3BhdGguc3RhdCgpLnN0X210aW1lICogMTAwMCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9jYWxfbXRpbWUgPj0gcmVtb3RlX210aW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgIyDsm5Dqsqnsl5DshJwg6rCA7KC47Jik6riwCiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGZldGNoX2RvY19jb250ZW50KGRvYykKICAgICAgICAgICAgICAgICAgICBpZiBjb250ZW50OgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoLnBhcmVudC5ta2RpcihwYXJlbnRzPVRydWUsIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGgud3JpdGVfdGV4dChjb250ZW50LCBlbmNvZGluZz0idXRmLTgiKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAg4oaQIHtwYXRofSIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICMg7IOB7YOcIOyXheuNsOydtO2KuAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9zdGF0ZVtwYXRoXSA9IGxvY2FsX3BhdGguc3RhdCgpLnN0X210aW1lCgogICAgICAgICAgICAgICAgbGFzdF9zZXEgPSBuZXdfc2VxCgogICAgICAgICAgICAjID09PSDroZzsu6wg7YyM7J28IOuzgOqyvSDqsJDsp4AgKOyjvOq4sOyggSkgPT09CiAgICAgICAgICAgIG5vdyA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIGlmIG5vdyAtIGxhc3RfbG9jYWxfY2hlY2sgPj0gcG9sbF9pbnRlcnZhbDoKICAgICAgICAgICAgICAgIGxhc3RfbG9jYWxfY2hlY2sgPSBub3cKICAgICAgICAgICAgICAgIG5ld19zdGF0ZSA9IGdldF9sb2NhbF9maWxlc19zdGF0ZSgpCgogICAgICAgICAgICAgICAgIyDrs4Dqsr3rkJwg7YyM7J28IOywvuq4sAogICAgICAgICAgICAgICAgY2hhbmdlZCA9IFtdCiAgICAgICAgICAgICAgICBmb3IgcGF0aCwgbXRpbWUgaW4gbmV3X3N0YXRlLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYgcGF0aCBub3QgaW4gbG9jYWxfc3RhdGUgb3IgbG9jYWxfc3RhdGVbcGF0aF0gPCBtdGltZToKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZC5hcHBlbmQocGF0aCkKCiAgICAgICAgICA=ICAgICAgIyDsg4gg7YyM7J28IOywvuq4sAogICAgICAgICAgICAgICAgZm9yIHBhdGggaW4gbmV3X3N0YXRlOgogICAgICAgICAgICAgICAgICAgIGlmIHBhdGggbm90IGluIGxvY2FsX3N0YXRlOgogICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkLmFwcGVuZChwYXRoKQoKICAgICAgICAgICAgICAgIGlmIGNoYW5nZWQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbltMT0NBTF0ge2xlbihjaGFuZ2VkKX0gY2hhbmdlcyBkZXRlY3RlZCIsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZm9yIHBhdGggaW4gY2hhbmdlZDoKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gVkFVTFRfUk9PVCAvIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHVzaF9maWxlX3RvX2NvdWNoZGIoZmlsZV9wYXRoLCBWQVVMVF9ST09ULCBhcmdzKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICDihpIge3BhdGh9IiwgZmx1c2g9VHJ1ZSkKCiAgICAgICAgICAgICAgICBsb2NhbF9zdGF0ZSA9IG5ld19zdGF0ZQoKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwcmludCgiXG5cblN0b3BwaW5nIGxpdmUgc3luYy4uLiIsIGZsdXNoPVRydWUpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgSW5kZXggQ29tbWFuZAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBnZW5lcmF0ZV9pbmRleChhcmdzKSAtPiBkaWN0OgogICAgIiIiSU5ERVgubWQg7IOd7ISxIiIiCiAgICBzdGF0cyA9IHsiY3JlYXRlZCI6IDAsICJwcm9qZWN0cyI6IDB9CgogICAgIyDrqqjrk6Agd29ya3NwYWNlIOyymOumrAogICAgd29ya3NwYWNlX2RpcnMgPSBbCiAgICAgICAgKFdPUktTUEFDRV9ESVIsICJ3b3Jrc3BhY2UiKSwKICAgICAgICAoV09SS1NQQUNFX1ZJQkVfRElSLCAid29ya3NwYWNlLXZpYmUiKSwKICAgICAgICAoV09SS1NQQUNFX0VYVF9ESVIsICJ3b3Jrc3BhY2UtZXh0IiksCiAgICBdCgogICAgZm9yIGJhc2VfZGlyLCB3c19uYW1lIGluIHdvcmtzcGFjZV9kaXJzOgogICAgICAgIGlmIG5vdCBiYXNlX2Rpci5leGlzdHMoKToKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgIyDtlITroZzsoJ3tirjrs4Qg66y47IScIOyImOynkQogICAgICAgIHByb2plY3RzID0ge30KICAgICAgICBmb3IgbWRfZmlsZSBpbiBiYXNlX2Rpci5nbG9iKCIqLyovKiovKi5tZCIpOgogICAgICAgICAgICBpZiBtZF9maWxlLm5hbWUgPT0gIklOREVYLm1kIjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBwYXJ0cyA9IG1kX2ZpbGUucGFydHMKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd3NfaWR4ID0gcGFydHMuaW5kZXgod3NfbmFtZSkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgcHJvamVjdCA9IHBhcnRzW3dzX2lkeCArIDFdCgogICAgICAgICAgICBpZiBhcmdzLnByb2plY3QgYW5kIHByb2plY3QgIT0gYXJncy5wcm9qZWN0OgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGlmIHByb2plY3Qgbm90IGluIHByb2plY3RzOgogICAgICAgICAgICAgICAgcHJvamVjdHNbcHJvamVjdF0gPSBbXQogICAgICAgICAgICBwcm9qZWN0c1twcm9qZWN0XS5hcHBlbmQobWRfZmlsZSkKCiAgICAgICAgZm9yIHByb2plY3QsIGRvY3MgaW4gcHJvamVjdHMuaXRlbXMoKToKICAgICAgICAgICAgc3RhdHNbInByb2plY3RzIl0gKz0gMQoKICAgICAgICAgICAgIyDtj7TrjZTrs4Qg67aE66WYCiAgICAgICAgICAgIGJ5X2ZvbGRlciA9IHt9CiAgICAgICAgICAgIGZvciBkb2MgaW4gZG9jczoKICAgICAgICAgICAgICAgIGlmICJjb250ZXh0IiBpbiBkb2MucGFydHM6CiAgICAgICAgICAgICAgICAgICAgZm9sZGVyID0gImNvbnRleHQiCiAgICAgICAgICAgICAgICBlbGlmICJzZXNzaW9ucyIgaW4gZG9jLnBhcnRzOgogICAgICAgICAgICAgICAgICAgIGZvbGRlciA9ICJzZXNzaW9ucyIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZm9sZGVyID0gIm90aGVyIgoKICAgICAgICAgICAgICAgIGlmIGZvbGRlciBub3QgaW4gYnlfZm9sZGVyOgogICAgICAgICAgICAgICAgICAgIGJ5X2ZvbGRlcltmb2xkZXJdID0gW10KICAgICAgICAgICAgICAgIGJ5X2ZvbGRlcltmb2xkZXJdLmFwcGVuZChkb2MpCgogICAgICAgICAgICAjIElOREVYIOyDneyEsQogICAgICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKS5pc29mb3JtYXQodGltZXNwZWM9InNlY29uZHMiKQogICAgICAgICAgICBpbmRleF9jb250ZW50ID0gZiIiIi0tLQpjcmVhdGVkOiB7bm93fQp1cGRhdGVkOiB7bm93fQpwcm9qZWN0OiB7cHJvamVjdH0KdGFnczogW2luZGV4LCBtb2MsIGF1dG8tZ2VuZXJhdGVkXQotLS0KCiMge3Byb2plY3R9Cgo+IOyekOuPmSDsg53shLHrkJwg7ZSE66Gc7KCd7Yq4IOyduOuNseyKpOyeheuLiOuLpC4KCiIiIgoKICAgICAgICAgICAgZm9yIGZvbGRlciBpbiBbImNvbnRleHQiLCAic2Vzc2lvbnMiLCAib3RoZXIiXToKICAgICAgICAgICAgICAgIGlmIGZvbGRlciBub3QgaW4gYnlfZm9sZGVyOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgaWNvbiA9IHsiY29udGV4dCI6ICLwn5OCIiwgInNlc3Npb25zIjogIvCfkqwiLCAib3RoZXIiOiAi8J+TgSJ9W2ZvbGRlcl0KICAgICAgICAgICAgICAgIGluZGV4X2NvbnRlbnQgKz0gZiIjIyB7aWNvbn0ge2ZvbGRlcn0vXG5cbiIKCiAgICAgICAgICAgICAgICBmb3IgZG9jIGluIHNvcnRlZChieV9mb2xkZXJbZm9sZGVyXSwga2V5PWxhbWJkYSB4OiB4Lm5hbWUpOgogICAgICAgICAgICAgICAgICAgIHJlbF9wYXRoID0gZiJ7d3NfbmFtZX0ve3Byb2plY3R9L3tmb2xkZXJ9L3tkb2MubmFtZX0iLnJlcGxhY2UoIi5tZCIsICIiKQogICAgICAgICAgICAgICAgICAgIGluZGV4X2NvbnRlbnQgKz0gZiItIFtbe3JlbF9wYXRofXx7ZG9jLnN0ZW19XV1cbiIKCiAgICAgICAgICAgICAgICBpbmRleF9jb250ZW50ICs=PSAiXG4iCgogICAgICAgICAgICBpbmRleF9jb250ZW50ICs9IGYiLS0tXG7stJ0g66y47IScOiB7bGVuKGRvY3MpfeqwnFxuIgoKICAgICAgICAgICAgaW5kZXhfcGF0aCA9IGJhc2VfZGlyIC8gcHJvamVjdCAvICJJTkRFWC5tZCIKCiAgICAgICAgICAgIGlmIGFyZ3MuZHJ5X3J1bjoKICAgICAgICAgICAgICAgIHByaW50KGYiICBbRFJZLVJVTl0ge3dzX25hbWV9L3twcm9qZWN0fS9JTkRFWC5tZCAoe2xlbihkb2NzKX0gZG9jcykiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaW5kZXhfcGF0aC5wYXJlbnQubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgaW5kZXhfcGF0aC53cml0ZV90ZXh0KGluZGV4X2NvbnRlbnQsIGVuY29kaW5nPSJ1dGYtOCIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgQ3JlYXRlZDoge3dzX25hbWV9L3twcm9qZWN0fS9JTkRFWC5tZCAoe2xlbihkb2NzKX0gZG9jcykiKQoKICAgICAgICAgICAgc3RhdHNbImNyZWF0ZWQiXSArPSAxCgogICAgcmV0dXJuIHN0YXRzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTWFpbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBtYWluKCk6CiAgICBwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcigKICAgICAgICBkZXNjcmlwdGlvbj0iT2JzaWRpYW4gVmF1bHQgU3luYyAtIO2Gte2VqSDsiqTtgazrpr3tirgiLAogICAgICAgIGZvcm1hdHRlcl9jbGFzcz1hcmdwYXJzZS5SYXdEZXNjcmlwdGlvbkhlbHBGb3JtYXR0ZXIsCiAgICAgICAgZXBpbG9nPSIiIgpDb21tYW5kczoKICBzeW5jICAgICAgQ2xhdWRlIOyEuOyFmCDrj5nquLDtmZQgKEpTT05MIOKGkiBNYXJrZG93bikKICBjbGVhbnVwICAg7IS47IWYIOygleumrCAoV2FybXVwLCDruYgg7YyM7J28IOyCreygnCkKICB0YWdzICAgICAg7YOc6re4IOyekOuPmSDstpTqsIAKICBpbmRleCAgICAgSU5ERVgubWQg7IOd7ISxCiAgbWlncmF0ZSAgIOq4sOyhtCDtjIzsnbzrqoXsnYQgWVlZWS1NTS1ERC17aWR9IO2YleyLneycvOuhnCDrs4DtmZgKICBwdXNoICAgICAgQ291Y2hEQuyXkCDtjIzsnbwg7ZG47IucIChMaXZlU3luYyDtmLjtmZgpCiAgcHVsbCAgICAgIENvdWNoRELsl5DshJwg7YyM7J28IOqwgOyguOyYpOq4sCAoTGl2ZVN5bmMg7Zi47ZmYKQogIHdhdGNoICAgICDsi6Tsi5zqsIQg7JaR67Cp7ZalIOuPmeq4sO2ZlCAoTGl2ZSBTeW5jKQoKRXhhbXBsZXM6CiAgJShwcm9nKXMgICAgICAgICAgICAgICAgICAgICMg7KCE7LK0IOyLpO2WiSAoc3luY+KGkmNsZWFudXDihpJ0YWdz4oaSaW5kZXgpCiAgJShwcm9nKXMgc3luYyAtLWRyeS1ydW4gICAgICMg64+Z6riw7ZmUIOuvuOumrOuztOq4sAogICUocHJvZylzIGNsZWFudXAgICAgICAgICAgICAjIOyEuOyFmCDsoJXrpqwKICAlKHByb2cpcyB0YWdzIC0tcHJvamVjdCB4ICAgIyDtirnsoJUg7ZSE66Gc7KCd7Yq4IO2DnOq3uOunjAogICUocHJvZylzIG1pZ3JhdGUgLS1kcnktcnVuICAjIO2MjOydvOuqhSDrp4jsnbTqt7jroIjsnbTshZgg66+466as67O06riwCiAgJShwcm9nKXMgcHVzaCAgICAgICAgICAgICAgICMgQ291Y2hEQuyXkCDtkbjsi5wKICAlKHByb2cpcyBwdWxsICAgICAgICAgICAgICAgIyBDb3VjaERC7JeQ7IScIOqwgOyguOyYpOq4sAogICUocHJvZylzIHB1bGwgcHVzaCAgICAgICAgICAjIOyWkeuwqe2WpSDrj5nquLDtmZQKICAlKHByb2cpcyB3YXRjaCAgICAgICAgICAgICAgIyDsi6Tsi5zqsIQg64+Z6riw7ZmUIChDdHJsK0ProZwg7KSR7KeAKQoiIiIKICAgICkKCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCJjb21tYW5kIiwgbmFyZ3M9IioiLCBkZWZhdWx0PVsiYWxsIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IuyLpO2Wie2VoCDrqoXroLk6IGFsbCwgc3luYywgY2xlYW51cCwgdGFncywgaW5kZXgsIG1pZ3JhdGUsIHB1c2gsIHB1bGwgKGRlZmF1bHQ6IGFsbCkiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1kcnktcnVuIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0i66+466as67O06riwIOuqqOs=k5wiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1mb3JjZSIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9Iuq4sOyhtCDtjIzsnbwg642u7Ja07JOw6riwIikKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tdmVyYm9zZSIsICItdiIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGhlbHA9IuyDgeyEuCDstpzroKUiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1wcm9qZWN0IiwgdHlwZT1zdHIsIGhlbHA9Iu2KueyglSDtlITroZzsoJ3tirjrp4wiKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgiLS1tYWNoaW5lIiwgdHlwZT1zdHIsIGhlbHA9Iu2KueyglSDrqLjsi6Drp4wgKHN5bmMpIikKCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIHByaW50KCI9IiAqIDUwKQogICAgcHJpbnQoIk9ic2lkaWFuIFZhdWx0IFN5bmMiKQogICAgcHJpbnQoIj0iICogNTApCiAgICBwcmludChmIlZhdWx0OiB7VkFVTFRfUk9PVH0iKQogICAgcHJpbnQoZiJNb2RlOiB7J0RSWS1SVU4nIGlmIGFyZ3MuZHJ5X3J1biBlbHNlICdMSVZFJ30iKQogICAgaWYgYXJncy5wcm9qZWN0OgogICAgICAgIHByaW50KGYiUHJvamVjdDoge2FyZ3MucHJvamVjdH0iKQogICAgcHJpbnQoKQoKICAgICMg66qF66C57Ja0IOyymOumrAogICAgY21kX2xpc3QgPSBhcmdzLmNvbW1hbmQgaWYgYXJncy5jb21tYW5kIGVsc2UgWyJhbGwiXQogICAgaWYgImFsbCIgaW4gY21kX2xpc3Q6CiAgICAgICAgY29tbWFuZHMgPSBbInN5bmMiLCAiY2xlYW51cCIsICJ0YWdzIiwgImluZGV4Il0KICAgIGVsc2U6CiAgICAgICAgY29tbWFuZHMgPSBjbWRfbGlzdAoKICAgIGZvciBjbWQgaW4gY29tbWFuZHM6CiAgICAgICAgcHJpbnQoZiJcbnsnPScqMjB9IHtjbWQudXBwZXIoKX0geyc9JyoyMH0iKQoKICAgICAgICBpZiBjbWQgPT0gInN5bmMiOgogICAgICAgICAgICBzdGF0cyA9IHN5bmNfc2Vzc2lvbnMoYXJncykKICAgICAgICAgICAgcHJpbnQoZiJcblN5bmM6IHtzdGF0c1snc3luY2VkJ119IHN5bmNlZCwge3N0YXRzWydza2lwcGVkJ119IHNraXBwZWQsIHtzdGF0c1snZXJyb3JzJ119IGVycm9ycyIpCgogICAgICAgIGVsaWYgY21kID09ICJjbGVhbnVwIjoKICAgICAgICAgICAgc3RhdHMgPSBjbGVhbnVwX3Nlc3Npb25zKGFyZ3MpCiAgICAgICAgICAgIHByaW50KGYiXG5DbGVhbnVwOiB7c3RhdHNbJ2RlbGV0ZWQnXX0gZGVsZXRlZCwge3N0YXRzWyd3YXJtdXAnXX0gd2FybXVwLCB7c3RhdHNbJ2ZpeGVkJ119IGZpeGVkIikKCiAgICAgICAgZWxpZiBjbWQgPT0gInRhZ3MiOgogICAgICAgICAgICBzdGF0cyA9IGVuaGFuY2VfdGFncyhhcmdzKQogICAgICAgICAgICBwcmludChmIlxuVGFnczoge3N0YXRzWyd1cGRhdGVkJ119L3tzdGF0c1snc2Nhbm5lZCddfSB1cGRhdGVkIikKCiAgICAgICAgZWxpZiBjbWQgPT0gImluZGV4IjoKICAgICAgICAgICAgc3RhdHMgPSBnZW5lcmF0ZV9pbmRleChhcmdzKQogICAgICAgICAgICBwcmludChmIlxuSW5kZXg6IHtzdGF0c1snY3JlYXRlZCddfSBwcm9qZWN0cyIpCgogICAgICAgIGVsaWYgY21kID09ICJtaWdyYXRlIjoKICAgICAgICAgICAgc3RhdHMgPSBtaWdyYXRlX3Nlc3Npb25fZmlsZW5hbWVzKGFyZ3MpCiAgICAgICAgICAgIHByaW50KGYiXG5NaWdyYXRlOiB7c3RhdHNbJ21pZ3JhdGVkJ119IG1pZ3JhdGVkLCB7c3RhdHNbJ3NraXBwZWQnXX0gc2tpcHBlZCwge3N0YXRzWydlcnJvcnMnXX0gZXJyb3JzIikKCiAgICAgICAgZWxpZiBjbWQgPT0gInB1c2giOgogICAgICAgICAgICBwcmludCgiXG5bSU5GT10gQ291Y2hEQiBwdXNoIGlzIG5vdyBoYW5kbGVkIGJ5IE9ic2lkaWFuIExpdmVTeW5jIHBsdWdpbi4iKQogICAgICAgICAgICBwcmludCgiICAgICAgIExvY2FsIGZpbGUgY2hhbmdlcyBhcmUgYXV0b21hdGljYWxseSBzeW5jZWQgd2hlbiBPYnNpZGlhbiBpcyBydW5uaW5nLiIpCiAgICAgICAgICAgIHByaW50KCIgICAgICAgVG8gZm9yY2Ugc3luYzogT3BlbiBPYnNpZGlhbiDihpIgU2V0dGluZ3Mg4oaSIExpdmVTeW5jIOKGkiBSZWJ1aWxkIikKCiAgICAgICAgZWxpZiBjbWQgPT0gInB1bGwiOgogICAgICAgICAgICBwcmludCgiXG5bSU5GT10gQ291Y2hEQiBwdWxsIGlzIG5vdyBoYW5kbGVkIGJ5IE9ic2lkaWFuIExpdmVTeW5jIHBsdWdpbi4iKQogICAgICAgICAgICBwcmludCgiICAgICAgIFJlbW90ZSBjaGFuZ2VzIGFyZSBhdXRvbWF0aWNhbGx5IHN5bmNlZCB3aGVuIE9ic2lkaWFuIGlzIHJ1bm5pbmcuIikKICAgICAgICAgICAgcHJpbnQoIiAgICAgICBUbyBmb3JjZSBzeW5jOiBPcGVuIE9ic2lkaWFuIOKGkiBTZXR0aW5ncyDihpIgTGl2ZVN5bmMg4oaSIFJlYnVpbGQiKQoKICAgICAgICBlbGlmIGNtZCA9PSAid2F0Y2giOgogICAgICAgICAgICB3YXRjaF9hbmRfc3luYyhhcmdzKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIlxuVW5rbm93biBjb21tYW5kOiB7Y21kfSIpCgogICAgcHJpbnQoIlxuIiArICI9IiAqIDUwKQogICAgcHJpbnQoIkNvbXBsZXRlISIpCgogICAgaWYgYXJncy5kcnlfcnVuOgogICAgICAgIHByaW50KCJcblJ1biB3aXRob3V0IC0tZHJ5LXJ1biB0byBhcHBseSBjaGFuZ2VzIikKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg==